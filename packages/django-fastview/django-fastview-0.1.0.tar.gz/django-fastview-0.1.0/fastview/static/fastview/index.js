(()=>{"use strict";(()=>{function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var o="fastview-formset",i=function(){function e(r,n,o){t(this,e),this.formset=r,this.rootEl=n,this.prefix=o,this.rootEl.classList.add("js-enabled"),this.deleteEl=this.getDeleteEl(),this.deleteCon=this.getDeleteCon(),this.render()}return n(e,[{key:"isExtra",value:function(e,t){var r=this;return!Array.from(this.rootEl.querySelectorAll("input, select, textarea")).some((function(n){var o=n.name.replace("".concat(r.prefix,"-"),"");return!(o!=t||!n.value)||!(o in e)||n.value!=e[o]}))}},{key:"getDeleteEl",value:function(){var e=this,t=this.rootEl.querySelector('[name="'.concat(this.prefix,'-DELETE"]'));if(t)return t.onchange=function(){t.checked?e.deleted():e.undeleted()},t}},{key:"getDeleteCon",value:function(){if(this.deleteEl)return this.deleteEl.parentNode}},{key:"isDeleted",get:function(){return this.deleteEl.checked}},{key:"deleted",value:function(){this.formset.deletedForm(this)}},{key:"undeleted",value:function(){this.formset.addedForm(this)}},{key:"formsetChanged",value:function(){this.render()}},{key:"render",value:function(){this.deleteCon&&(this.rootEl.classList.toggle("deleted",this.isDeleted),this.formset.canDelete?this.deleteCon.style.removeProperty("display"):this.deleteCon.style.setProperty("display","none"))}}]),e}(),s=function(){function r(n,o){var s=this;t(this,r),e(this,"dataForm","fastview-formset-form"),e(this,"dataTemplate","fastview-formset-template"),e(this,"dataPk","fastview-formset-pk"),e(this,"formClass",i),this.rootEl=n,this.prefix=o,this.totalFormsEl=document.getElementById("id_".concat(o,"-TOTAL_FORMS")),this.initialFormsEl=document.getElementById("id_".concat(o,"-INITIAL_FORMS")),this.numFormsMin=parseInt(document.getElementById("id_".concat(o,"-MIN_NUM_FORMS")).value,10),this.numFormsMax=parseInt(document.getElementById("id_".concat(o,"-MAX_NUM_FORMS")).value,10);var a=n.getAttribute("data-".concat(this.dataPk));this.template=n.querySelector("[data-".concat(this.dataTemplate,"]")),this.templatePrefix=this.template.getAttribute("data-".concat(this.dataTemplate));var l=Array.from(n.querySelectorAll("[data-".concat(this.dataForm,"]"))).reverse();this.numForms=l.length;var d=parseInt(this.initialFormsEl.value,10),u=this.numForms>d,m={};u&&Array.from(this.template.querySelectorAll("input, select, textarea")).forEach((function(e){var t=e.name.replace("".concat(s.templatePrefix,"-"),"");m[t]=e.value})),this.forms=[],l.forEach((function(e){var t=e.getAttribute("data-".concat(s.dataForm)),r=new s.formClass(s,e,t);if(u&&r.isExtra(m,a))return e.remove(),s.numForms-=1,void e.dispatchEvent(new CustomEvent("fastview-formset-destroyForm",{bubbles:!0,detail:{formset:s,form:r}}));s.forms.push(r)})),this.forms.reverse(),this.addEl=this.getAddEl(),this.addCon=this.getAddCon(),this.render()}return n(r,[{key:"getAddEl",value:function(){var e=this,t=document.createElement("button");return t.innerHTML="Add",t.type="button",t.className="fastview-add",this.rootEl.appendChild(t),t.onclick=function(){e.addForm()},t}},{key:"getAddCon",value:function(){return this.addEl}},{key:"addForm",value:function(){var e=this.nextId,t=this.createForm(e),r=this.insertForm(e,t);this.addedForm(r),t.dispatchEvent(new CustomEvent("fastview-formset-createForm",{bubbles:!0,detail:{formset:this,form:r}}))}},{key:"render",value:function(){this.forms.forEach((function(e){e.formsetChanged()})),this.canAdd?this.addCon.style.removeProperty("display"):this.addCon.style.setProperty("display","none")}},{key:"numForms",get:function(){return parseInt(this.totalFormsEl.value,10)},set:function(e){this.totalFormsEl.value=e}},{key:"nextId",get:function(){return this.numForms}},{key:"createForm",value:function(e){var t=this.template.innerHTML.replace(/__prefix__/g,e),r=this.template.cloneNode();return r.classList.add("added"),r.removeAttribute("style"),r.innerHTML=t,r}},{key:"insertForm",value:function(e,t){var r=this.template;this.forms.length>0&&(r=this.forms[this.forms.length-1].rootEl),r.parentNode.insertBefore(t,r.nextSibling);var n=this.templatePrefix.replace("__prefix__",e),o=new i(this,t,n);return this.forms.push(o),o}},{key:"addedForm",value:function(e){this.numForms+=1,this.render(),e.rootEl.dispatchEvent(new CustomEvent("fastview-formset-addForm",{bubbles:!0,detail:{formset:this,form:e}}))}},{key:"deletedForm",value:function(e){e.rootEl.dispatchEvent(new CustomEvent("fastview-formset-deleteForm",{bubbles:!0,detail:{formset:this,form:e}})),this.numForms-=1,this.render()}},{key:"canAdd",get:function(){return this.numForms<this.numFormsMax}},{key:"canDelete",get:function(){return this.numForms>this.numFormsMin}}]),r}();document.addEventListener("DOMContentLoaded",(function(e){!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;document.querySelectorAll("[data-".concat(e,"]")).forEach((function(r){var n=r.getAttribute("data-".concat(e));new t(r,n)}))}()}))})()})();
//# sourceMappingURL=index.js.map