#!/usr/bin/env python3
# This file is placed in the Public Domain.


"console"


import inspect
import os
import sys


sys.path.insert(0, os.getcwd())


from op.hdl import Client, Command, Commands
from op.hdl import Cfg, docmd, parse, scan
from op.obj import Wd


from bot import bsc, irc, rss


Wd.workdir = os.path.expanduser("~/.bot")


scan(bsc)
scan(irc)
scan(rss)


class CLI(Client):

    "cli"

    def docmd(self, txt):
        cmd = Command()
        cmd.channel = ""
        cmd.orig = repr(self)
        cmd.txt = txt
        self.handle(cmd)
        cmd.wait()

    def raw(self, txt):
        print(txt)
        sys.stdout.flush()


def cmd(event):
    event.reply(",".join(sorted(Commands.cmd)))


def main():
    parse(" ".join(sys.argv[1:]))
    Commands.add(cmd)
    clt = CLI()
    docmd(clt, Cfg.txt)


if __name__ == "__main__":
    main()
