"use strict";(self.webpackChunkatoti_jupyterlab=self.webpackChunkatoti_jupyterlab||[]).push([[8789],{78789:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Y});var n=a(8336),o=a(56271),s=a(39349),i=a(39030),r=a(94158),l=a(35129),u=a(3440),d=a.n(u),c=a(87622),y=a.n(c),p=a(9439),x=a.n(p),m=a(53347),v=a(66611),C=a(37946),g=a(80877),f=a(93897),h=a(66378),b=a(21469),E=a(50654),k=a(95923),N={name:"10bhair-QueryContextEntryTileCaption",styles:"display:flex;margin-right:16px;;label:QueryContextEntryTileCaption;"},w={name:"1hmgl6r-QueryContextEntryTileCaption",styles:"flex-grow:1;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;;label:QueryContextEntryTileCaption;"},Q={name:"whkwzk-QueryContextEntryTileCaption",styles:"text-align:right;flex-grow:1;flex-shrink:1;margin-left:10px;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;min-width:35px;;label:QueryContextEntryTileCaption;"};const T=e=>{let t;const[a,s]=(0,o.useState)(null);if((0,o.useEffect)((()=>{"BOOL"!==e.type&&"ENUM"!==e.type&&s(e.value)}),[e.type,e.value]),"BOOL"===e.type)t=(0,n.jsx)(C.default,{checked:Boolean(e.value),disabled:e.isDisabled,onChange:()=>{var t;return null===(t=e.onValueChanged)||void 0===t?void 0:t.call(e,!e.value)}});else if(e.isDisabled)t=e.value;else if(e.type.startsWith("ENUM")){const a=(0,l.Vr)(e.type);t=(0,n.jsx)(f.Z,{value:e.value,size:"small",onChange:e.onValueChanged,disabled:e.isDisabled},a.map((e=>(0,n.jsx)(f.Z.Option,{key:e,value:e},e))))}else t=(0,n.jsx)(g.Z,{value:null!=a?a:"",onChange:e=>s(e.target.value),onBlur:t=>{const a=t.target.value;var n;isNaN(Number(a))&&"ALL"!==e.type||null===(n=e.onValueChanged)||void 0===n||n.call(e,a)},size:"small",disabled:e.isDisabled});return(0,n.jsx)("div",{css:N,key:e.name},(0,n.jsx)("div",{css:w,title:e.name},e.name),(0,n.jsx)("div",{css:Q},t))};var j={name:"1etlk4r-QueryContextEntryEditionPopup",styles:"height:35px;display:flex;justify-content:flex-end;margin-top:8px;;label:QueryContextEntryEditionPopup;"},K={name:"hpxvrh-QueryContextEntryEditionPopup",styles:"&.ant-btn{margin-right:8px;};label:QueryContextEntryEditionPopup;"};const S=e=>{var t;const{formatMessage:a}=(0,s.useIntl)(),{onOk:i,onCancel:r,templatedName:l}=e,[u,d]=(0,o.useState)(""),[c,y]=(0,o.useState)(""),p=(e=>{const t=e.indexOf("$"),a=e.lastIndexOf("$");return e.substring(t,a+1)})(l),x=l.replace(p,u);return(0,n.jsx)("div",{style:{width:400,display:"flex",flexDirection:"column"}},(0,n.jsx)("div",{style:{flexGrow:1}},(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:p,value:u,onChange:e=>d(e.target.value)}),(0,n.jsx)(g.Z,{style:{marginTop:8},placeholder:"value",value:c,onChange:e=>y(e.target.value)})),(0,n.jsx)("div",{css:j},(0,n.jsx)(b.default,{css:K,onClick:r},a({id:"aui.cancel"})),(0,n.jsx)(b.default,{onClick:()=>{i(x,c)},disabled:0===u.length||0===c.length||(null===(t=e.queryContext)||void 0===t?void 0:t.some((({key:e})=>e===x))),type:"primary"},a({id:"aui.ok"}))))},q=["drillthrough.hiddencolumns","subcube"],O=["mdx.kpi","mdx.member","mdx.formatters","mdx.set","mdx.measureAlias","mdx.defaultmembers","user-authentication"],I=["dashboard","page","widget"],V=(e,{sectionName:t,pageKey:a,leafKey:n})=>{const o="dashboard"===t?e:"page"===t?(0,E.fx)(e,a):(0,E.LI)(e,a,n);if(!o)throw new Error(`Impossible to edit the ${t}'s query context, as its corresponding state was not found.`);return o},R=(e,t,a)=>{e.queryContext||(e.queryContext=[]),e.queryContext.splice(a,0,t)},D=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,queryContextEntry:s,position:i})=>{let r=n,l=e;return"user"===o?r=(0,h.produce)(n,(e=>{e.splice(i,0,s)})):l=(0,h.produce)(e,(e=>{const n=V(e,{sectionName:o,pageKey:t,leafKey:a});R(n,s,i)})),[l,r]},_=(e,t)=>{if(!e.queryContext)return;const{queryContext:a}=e;a.splice(t,1),0===a.length&&delete e.queryContext},P=({dashboardState:e,pageKey:t,leafKey:a,userQueryContext:n,sectionName:o,position:s})=>{let i=n,r=e;return"user"===o?i=(0,h.produce)(n,(e=>{e.splice(s,1)})):r=(0,h.produce)(e,(e=>{const n=V(e,{sectionName:o,pageKey:t,leafKey:a});_(n,s)})),[r,i]},Y=(0,i.r3)((e=>{const{dashboardState:t,pageKey:a,leafKey:u,onDashboardChange:c}=(0,v.F)(e)?e:{},{dataModel:p,widgetState:C,onWidgetChange:g}=e,{formatMessage:f}=(0,s.useIntl)(),[b]=(0,k.yu)("userQueryContext.isEnabled");let E=I;b&&(E=["user",...I]);const N=(0,i.cQ)(C,t,a),[,w]=(0,k.XP)("userQueryContext"),[Q,j]=(0,o.useState)(null),K=(0,o.useMemo)((()=>y()(p.contextValues,"name")),[p.contextValues]),Y=(0,o.useCallback)((e=>{if(K[e])return K[e].type;const t=x()(K,(({name:t})=>e.startsWith(t.replace(/\$.*\$$/,""))));return t?K[t].type:"ALL"}),[K]),M=(0,o.useMemo)((()=>{const e=p.contextValues.filter((({name:e})=>!q.some((t=>e.startsWith(t))))),t=d()(e,(({category:e})=>e||"misc"));return Object.keys(t).map((e=>({caption:e,isFolder:!0,isActionable:!1,type:e,children:t[e].map((t=>{const a={type:"QUERY_CONTEXT_ENTRY",key:t.name};return{caption:t.name,type:e,isActionable:!0,isDisabled:E.every((e=>{var a;return null===(a=N[e])||void 0===a?void 0:a.some((({key:e})=>e===t.name))})),dragItem:a}}))})))}),[p.contextValues,N,E]),A=(0,o.useMemo)((()=>{const o={};return o.default={placeholder:f({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),caption:f({id:"aui.drawer.queryContextEditor.defaultSection"}),tiles:e.cube.contextValues.filter((({name:e})=>O.every((t=>!e.startsWith(t)))&&q.every((t=>!e.startsWith(t))))).map((({name:e,value:t},a)=>{const o={key:e,value:t,originSection:"default",originPosition:a,type:"QUERY_CONTEXT_ENTRY"};return{caption:(0,n.jsx)(T,{name:e,value:t,isDisabled:!0,type:Y(e)}),dragItem:o,isEditable:!1,isDisabled:E.some((t=>{var a;return null===(a=N[t])||void 0===a?void 0:a.some((({key:t})=>t===e))})),isRemovable:!1}}))},E.forEach((e=>{const s=N[e];o[e]={caption:f({id:`aui.drawer.queryContextEditor.${e}Section`}),tiles:s?s.map((({key:o,value:s},i)=>{const r={key:o,value:s,originSection:e,originPosition:i,type:"QUERY_CONTEXT_ENTRY"},l=E.slice(E.indexOf(e)+1).some((e=>{var t;return null===(t=N[e])||void 0===t?void 0:t.some((e=>o===e.key))}));return{caption:(0,n.jsx)(T,{name:o,value:s,type:Y(o),isDisabled:l,onValueChanged:n=>{if(c&&t&&a&&u)if("user"===e){if(!N.user)return;const e=(0,h.produce)(N.user,(e=>{e[i].value=n}));w(e)}else{const o=(0,h.produce)(t,(t=>{V(t,{leafKey:u,pageKey:a,sectionName:e}).queryContext[i].value=n}));c(o)}else{const e=(0,h.produce)(C,(e=>{e.queryContext[i].value=n}));g(e)}}}),isEditable:!1,isRemovable:!0,isDisabled:l,dragItem:r}})):[]}})),Q&&o[Q.sectionName].tiles.splice(Q.tileIndex,0,{caption:Q.key,dragItem:null}),o}),[Q,Y,e.cube.contextValues,N,t,f,u,c,g,a,C,w,E]),$=(0,o.useCallback)(((e,n)=>{if(c&&t&&a&&u){const[o,s]=P({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:N.user||[],sectionName:e,position:n});o!==t&&c(o),s!==N.user&&w(s)}else{const e=(0,h.produce)(C,(e=>{_(e,n)}));g(e)}}),[t,u,c,a,N.user,C,g,w]),L=(0,o.useCallback)(((n,o,s)=>{var i;const r=null!=s?s:(null===(i=N[n])||void 0===i?void 0:i.length)||0;if(-1!==o.indexOf("$"))j({tileIndex:r,sectionName:n,key:o});else{const s={key:o,value:(0,l.Q3)(K[o],e.cube.contextValues)};if(c&&t&&a&&u){const[e,o]=D({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:N.user||[],sectionName:n,queryContextEntry:s,position:r});e!==t&&c(e),o!==N.user&&w(o)}else{const e=(0,h.produce)(C,(e=>{R(e,s,r)}));g(e)}}}),[K,t,u,c,g,a,N,C,e.cube.contextValues,w]),U=(0,o.useCallback)((e=>{var t;e.isActionable&&!(null===(t=N.widget)||void 0===t?void 0:t.some((({key:t})=>t===e.caption)))&&L("widget",e.caption)}),[L,N]),W=(0,o.useCallback)(((e,n)=>{if(Q){const o={key:e,value:n};if(c&&t&&a&&u){const[e,n]=D({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:N.user||[],sectionName:Q.sectionName,queryContextEntry:o,position:Q.tileIndex});e!==t&&c(e),n!==N.user&&w(n)}else{const e=(0,h.produce)(C,(e=>{R(e,o,Q.tileIndex)}));g(e)}j(null)}}),[t,u,c,g,a,Q,C,w,N.user]),X=(0,o.useCallback)(((e,n,o)=>{if(c&&t&&a&&u){var s;let i=t,r=null!==(s=N.user)&&void 0!==s?s:[];"default"!==n.originSection&&([i,r]=P({dashboardState:t,pageKey:a,leafKey:u,userQueryContext:N.user||[],sectionName:n.originSection,position:n.originPosition})),"default"!==e&&([i,r]=D({dashboardState:i,pageKey:a,leafKey:u,userQueryContext:r||[],sectionName:e,position:o,queryContextEntry:{key:n.key,value:n.value}})),i!==t&&c(i),r!==N.user&&w(r)}}),[t,u,c,a,w,N.user]),Z=(0,o.useCallback)(((e,t,a)=>{L(e,t.key,a)}),[L]);return(0,n.jsx)(i.A3,null,(0,n.jsx)(r.mp,{value:M,isSearchVisible:!0,searchPlaceholder:f({id:"aui.drawer.queryContextEditor.searchContextEntries"}),onClick:U}),(0,n.jsx)(m.e,{sections:A,dragItemTypes:["QUERY_CONTEXT_ENTRY"],canDrop:(e,t)=>{var a;return!("QUERY_CONTEXT_ENTRY"!==t.type||"default"===e||t.originSection&&t.originSection===e||(null===(a=N[e])||void 0===a?void 0:a.some((({key:e})=>e===t.key))))},placeholder:f({id:"aui.drawer.queryContextEditor.noQueryContextEntries"}),onTileRemoved:$,onTileMoved:X,onTileAdded:Z,popoverPosition:Q,popover:Q&&(0,n.jsx)(S,{onOk:W,templatedName:Q.key,onCancel:()=>j(null),queryContext:N[Q.sectionName]}),popoverInnerHeight:110}))}))}}]);