{"version":3,"file":"chunks/app_views_profiling_index_tsx.xxxxxxxxxxxxxxxxxxxx.js","mappings":"i1BA6BA,SAASA,EAAT,GAA6D,IAAjC,aAACC,EAAD,SAAeC,GAAkB,EAC3D,MAAMC,GAAMC,EAAAA,EAAAA,MAELC,EAAcC,IAAmBC,EAAAA,EAAAA,UAAmC,CACzEC,KAAM,aAIRC,EAAAA,EAAAA,YAAU,KACRH,EAAgB,CAACE,KAAM,aACvBE,EAAAA,EAAAA,IAAaP,EAAK,CAChBQ,eAAgBV,EAAaW,GAC7BC,QAAS,yBAERC,MAAKC,IACJT,EAAgB,CAACE,KAAM,WAAYO,KAAAA,OAEpCC,OAAMC,IACLC,EAAAA,GAAwBD,GACxBX,EAAgB,CAACE,KAAM,UAAWW,OAAOC,EAAAA,EAAAA,GAAE,4CAE9C,CAACjB,EAAKF,IAGT,MAAMoB,GAAgBC,EAAAA,EAAAA,cACnBC,IACCjB,EAAgB,CAACE,KAAM,WAAYO,KAAM,CAACS,cAAeC,KAAKC,UAC9DC,EAAAA,EAAAA,GAA4B,oCAAqC,CAC/DC,OAAQL,EACRtB,aAAAA,KAGK4B,EAAAA,EAAAA,IAAc1B,EAAK,CACxBU,QAAS,uBACTF,eAAgBV,EAAaW,GAI7BW,OAAQ,gBAGZ,CAACtB,EAAcE,IAGX2B,GAAaR,EAAAA,EAAAA,cAAY,KAC7BD,EAAc,UACb,CAACA,IAEEU,GAAgBT,EAAAA,EAAAA,cAAY,KAChCD,EAAc,eACb,CAACA,IAEJ,OACE,QAAC,IAAD,CACEW,SAAS,kCACTC,SAAU,CAAC,aACXhC,aAAcA,EACdiC,eAAgB,KACd,QAAC,KAAD,WACE,QAAC,IAAD,CAAO1B,KAAK,UAAZ,UAAuBY,EAAAA,EAAAA,GAAE,6CAN/B,SAUyB,YAAtBf,EAAaG,MACZ,QAAC,IAAD,KA7EqC2B,EA8EC9B,EA7EzB,aAAf8B,EAAM3B,MACoC,iBAArC,UAAO2B,EAAMpB,YAAb,aAAO,EAAYS,gBA6EtB,QAAC,IAAD,CACEvB,aAAcA,EACdmC,eAAgBL,EAChBM,YAAaP,IAGf5B,KArFR,IAA6CiC,EACZ,EAYxBnC,EAAAA,YAAAA,qBA8ET,SAAesC,EAAAA,EAAAA,GAAiBtC","sources":["webpack:///./app/views/profiling/index.tsx"],"sourcesContent":["import {useCallback, useEffect, useState} from 'react';\nimport * as Sentry from '@sentry/react';\n\nimport {PromptData, promptsCheck, promptsUpdate} from 'sentry/actionCreators/prompts';\nimport Feature from 'sentry/components/acl/feature';\nimport Alert from 'sentry/components/alert';\nimport LoadingIndicator from 'sentry/components/loadingIndicator';\nimport {t} from 'sentry/locale';\nimport {PageContent} from 'sentry/styles/organization';\nimport {Organization, RequestState} from 'sentry/types';\nimport trackAdvancedAnalyticsEvent from 'sentry/utils/analytics/trackAdvancedAnalyticsEvent';\nimport useApi from 'sentry/utils/useApi';\nimport withOrganization from 'sentry/utils/withOrganization';\n\nimport LegacyProfilingOnboarding from './legacyProfilingOnboarding';\n\nfunction shouldShowLegacyProfilingOnboarding(state: RequestState<PromptData>): boolean {\n  if (state.type === 'resolved') {\n    return typeof state.data?.dismissedTime !== 'number';\n  }\n\n  return false;\n}\n\ntype Props = {\n  children: React.ReactChildren;\n  organization: Organization;\n};\n\nfunction ProfilingContainer({organization, children}: Props) {\n  const api = useApi();\n\n  const [requestState, setRequestState] = useState<RequestState<PromptData>>({\n    type: 'initial',\n  });\n\n  // Fetch prompt data and see if we need to show the onboarding.\n  useEffect(() => {\n    setRequestState({type: 'loading'});\n    promptsCheck(api, {\n      organizationId: organization.id,\n      feature: 'profiling_onboarding',\n    })\n      .then(data => {\n        setRequestState({type: 'resolved', data});\n      })\n      .catch(e => {\n        Sentry.captureException(e);\n        setRequestState({type: 'errored', error: t('Error: Unable to load prompt data')});\n      });\n  }, [api, organization]);\n\n  // Eagerly update state and update check\n  const dismissPrompt = useCallback(\n    (status: 'done' | 'dismissed') => {\n      setRequestState({type: 'resolved', data: {dismissedTime: Date.now()}});\n      trackAdvancedAnalyticsEvent('profiling_views.onboarding_action', {\n        action: status,\n        organization,\n      });\n\n      return promptsUpdate(api, {\n        feature: 'profiling_onboarding',\n        organizationId: organization.id,\n        // This will always send dismissed, becuse we dont actually\n        // care about the snooze mechanism. It would be awkward to suddenly\n        // creep a full page into view.\n        status: 'dismissed',\n      });\n    },\n    [organization, api]\n  );\n\n  const handleDone = useCallback(() => {\n    dismissPrompt('done');\n  }, [dismissPrompt]);\n\n  const handleDismiss = useCallback(() => {\n    dismissPrompt('dismissed');\n  }, [dismissPrompt]);\n\n  return (\n    <Feature\n      hookName=\"feature-disabled:profiling-page\"\n      features={['profiling']}\n      organization={organization}\n      renderDisabled={() => (\n        <PageContent>\n          <Alert type=\"warning\">{t(\"You don't have access to this feature\")}</Alert>\n        </PageContent>\n      )}\n    >\n      {requestState.type === 'loading' ? (\n        <LoadingIndicator />\n      ) : shouldShowLegacyProfilingOnboarding(requestState) ? (\n        <LegacyProfilingOnboarding\n          organization={organization}\n          onDismissClick={handleDismiss}\n          onDoneClick={handleDone}\n        />\n      ) : (\n        children\n      )}\n    </Feature>\n  );\n}\n\nexport default withOrganization(ProfilingContainer);\n"],"names":["ProfilingContainer","organization","children","api","useApi","requestState","setRequestState","useState","type","useEffect","promptsCheck","organizationId","id","feature","then","data","catch","e","Sentry","error","t","dismissPrompt","useCallback","status","dismissedTime","Date","now","trackAdvancedAnalyticsEvent","action","promptsUpdate","handleDone","handleDismiss","hookName","features","renderDisabled","state","onDismissClick","onDoneClick","withOrganization"],"sourceRoot":""}