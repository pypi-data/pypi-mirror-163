(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_releases_detail_activity_index_tsx-node_modules_lodash_mean_js","node_modules_lodash_mean_js"],{"./app/utils/useApiRequests.tsx":(e,t,s)=>{"use strict";s.d(t,{Z:()=>x}),s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/core-js/modules/es.error.cause.js");var a=s("../node_modules/react/index.js"),i=s("../node_modules/@sentry/hub/esm/exports.js"),r=s("./app/components/loadingError.tsx"),n=s("./app/components/loadingIndicator.tsx"),o=s("./app/locale.tsx"),l=s("./app/utils/analytics.tsx"),d=s("./app/utils/getRouteStringFromRoutes.tsx"),u=s("./app/utils/useApi.tsx"),c=s("./app/utils/useLocation.tsx"),p=s("./app/utils/useParams.tsx"),m=s("./app/utils/useRoutes.tsx"),h=s("./app/views/permissionDenied.tsx"),g=s("./app/views/routeError.tsx"),v=s("./app/utils/useEffectAfterFirstRender.ts"),f=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function y(){return(0,f.tZ)(n.Z,{})}y.displayName="renderLoading";const x=function(e){let{endpoints:t,reloadOnVisible:s=!1,shouldReload:n=!1,shouldRenderBadRequests:x=!1,disableErrorReport:Z=!0,onLoadAllEndpointsSuccess:R=(()=>{}),onRequestSuccess:b=(e=>{}),onRequestError:E=((e,t)=>{})}=e;const w=(0,u.Z)(),_=(0,c.T)(),j=(0,p.U)(),C=(0,a.useMemo)((()=>({data:{},isLoading:!1,hasError:!1,isReloading:!1,errors:{},remainingRequests:t.length})),[t.length]),[q,S]=(0,a.useState)(C),k=function(){const e=(0,m.V)(),t=(0,a.useRef)({hasMeasured:!1,finished:!1,error:!1});return(0,a.useEffect)((()=>{t.current={hasMeasured:!1,finished:!1,error:!1},e&&e.length&&l.oF.mark({name:`async-component-${(0,d.Z)(e)}`})}),[e]),(0,a.useCallback)((s=>{let{finished:a,error:i}=s;if(e&&(a&&(t.current.finished=!0),i&&(t.current.error=!0),!t.current.hasMeasured&&t.current.finished)){const s=(0,d.Z)(e);l.oF.measure({name:"app.component.async-component",start:`async-component-${s}`,data:{route:s,error:t.current.error}}),t.current.hasMeasured=!0}}),[e])}(),L=(0,a.useCallback)(((e,t)=>{let{stateKey:s,data:a,resp:i}=e;S((e=>{const r={...e,data:{...e.data,[s]:a,[`${s}PageLinks`]:null==i?void 0:i.getResponseHeader("Link")}};return t&&(r.remainingRequests=e.remainingRequests-1,r.isLoading=e.remainingRequests>1,r.isReloading=e.isReloading&&r.isLoading,k({finished:0===r.remainingRequests})),r})),b({stateKey:s,data:a,resp:i})}),[b,k]),D=(0,a.useCallback)(((e,t)=>{const[s]=t;e&&e.responseText&&i.n_({message:e.responseText,category:"xhr",level:"error"}),S((t=>{const a=t.remainingRequests>1,i={errors:{...t.errors,[s]:e},data:{...t.data,[s]:null},hasError:t.hasError||!!e,remainingRequests:t.remainingRequests-1,isLoading:a,isReloading:t.isReloading&&a};return k({finished:0===i.remainingRequests,error:!0}),i})),E(e,t)}),[k,E]),z=(0,a.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.length?(w.clear(),S((s=>({...s,isLoading:!0,hasError:!1,remainingRequests:t.length,...e}))),await Promise.all(t.map((async e=>{var t;let[s,a,i,r]=e;r=null!==(t=r)&&void 0!==t?t:{};const n=_&&_.query||{};let o=i&&i.query||{};!r.paginate&&!n.cursor||r.disableEntireQuery||(o={...n,...o});try{const e=await w.requestPromise(a,{method:"GET",...i,query:o,includeAllArgs:!0}),[t,r,n]=e;L({stateKey:s,data:t,resp:n},!0)}catch(e){D(e,[s,a,i,r])}})))):S((e=>({...e,data:{},isLoading:!1,hasError:!1})))}),[w,t,D,L,_]),A=(0,a.useCallback)((()=>z({isReloading:!0})),[z]),I=(0,a.useCallback)((async()=>{try{await z()}catch(e){throw S((e=>({...e,hasError:!0}))),e}}),[z]);(0,a.useEffect)((()=>{I()}),[]);const N=(0,a.useCallback)((()=>n?A():(S({...C}),z())),[C,A,z,n]);(0,v.K)((()=>{N()}),[null==_?void 0:_.search,null==_?void 0:_.state,j]);const O=(0,a.useCallback)((()=>!q.isLoading&&!document.hidden&&A()),[q.isLoading,A]);(0,a.useEffect)((()=>(s&&document.addEventListener("visibilitychange",O),()=>document.removeEventListener("visibilitychange",O))),[s,O]),(0,a.useEffect)((()=>{t.length&&0===q.remainingRequests&&!q.hasError&&R()}),[q.remainingRequests,q.hasError,t.length]);const T=(0,a.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=q.errors,a=Object.values(s).some((e=>401===(null==e?void 0:e.status))),i=Object.values(s).some((e=>403===(null==e?void 0:e.status))),n=!!Object.values(s).some((e=>0!==(null==e?void 0:e.status)))||t;if(a)return(0,f.tZ)(r.Z,{message:(0,o.t)("You are not authorized to access this resource.")});if(i)return(0,f.tZ)(h.Z,{});if(x){const e=Object.values(s).filter((e=>{var t;return 400===(null==e?void 0:e.status)&&(null==e||null===(t=e.responseJSON)||void 0===t?void 0:t.detail)})).map((e=>e.responseJSON.detail));if(e.length)return(0,f.tZ)(r.Z,{message:[...new Set(e)].join("\n")})}return(0,f.tZ)(g.Z,{error:e,disableLogSentry:!n,disableReport:Z})}),[q.errors,Z,x]),F=q.isLoading&&(!n||!q.isReloading),P=(0,a.useCallback)((e=>F?y():q.hasError?T(new Error("Unable to load all required endpoints")):e),[F,q.hasError,T]);return{...q,renderComponent:P}}},"./app/utils/useEffectAfterFirstRender.ts":(e,t,s)=>{"use strict";s.d(t,{K:()=>i});var a=s("../node_modules/react/index.js");const i=(e,t)=>{const s=(0,a.useRef)(!0);(0,a.useEffect)((()=>{s.current?s.current=!1:e()}),t)}},"./app/utils/useLocation.tsx":(e,t,s)=>{"use strict";s.d(t,{T:()=>i});var a=s("./app/utils/useRouteContext.tsx");function i(){return(0,a.s)().location}},"./app/utils/useParams.tsx":(e,t,s)=>{"use strict";s.d(t,{U:()=>i});var a=s("./app/utils/useRouteContext.tsx");function i(){return(0,a.s)().params}},"./app/views/releases/detail/activity/index.tsx":(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>P});var a=s("./app/components/acl/feature.tsx"),i=s("./app/components/acl/featureDisabled.tsx"),r=s("./app/components/panels/index.tsx"),n=s("./app/locale.tsx"),o=s("./app/utils/useOrganization.tsx"),l=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),d=s("../node_modules/react/index.js"),u=s("./app/components/layouts/thirds.tsx"),c=s("./app/stores/groupStore.tsx"),p=s("./app/styles/space.tsx"),m=s("./app/utils/useApiRequests.tsx"),h=s("./app/utils/useParams.tsx"),g=s("./app/views/releases/detail/index.tsx"),v=s("./app/components/eventOrGroupExtraDetails.tsx"),f=s("./app/components/eventOrGroupHeader.tsx"),y=s("./app/components/timeSince.tsx"),x=s("./app/icons/index.tsx"),Z=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function R(e){return(0,Z.BX)(b,{children:[e.hideConnector?null:(0,Z.tZ)(_,{}),(0,Z.BX)(E,{children:[(0,Z.tZ)(j,{color:e.iconColor,children:e.icon}),(0,Z.tZ)(w,{children:e.children})]})]})}R.displayName="ReleaseActivityRow";const b=(0,l.Z)("div",{target:"e1ba1adz4"})({name:"9iujih",styles:"position:relative;display:flex;align-items:center"}),E=(0,l.Z)("div",{target:"e1ba1adz3"})({name:"dxf6zn",styles:"position:relative;display:flex;align-items:flex-start;flex-grow:1"}),w=(0,l.Z)("div",{target:"e1ba1adz2"})("flex-grow:1;margin-left:",(0,p.Z)(3),";"),_=(0,l.Z)("div",{target:"e1ba1adz1"})("position:absolute;height:100%;top:28px;left:23px;border-right:1px ",(e=>e.theme.gray300)," dashed;"),j=(0,l.Z)("div",{target:"e1ba1adz0"})("display:flex;align-items:center;padding:",(0,p.Z)(.5)," ",(0,p.Z)(1.5),";width:48px;height:48px;border-radius:50%;background-color:",(e=>e.theme[e.color]),";");let C;function q(e){const t=e.activity.type===C.FINISHED;return(0,Z.BX)(R,{icon:(0,Z.tZ)(A,{color:"white",size:"lg"}),iconColor:"gray500",hideConnector:t,children:[(0,Z.tZ)("div",{children:t?(0,n.t)("Release has been deployed for an hour and is no longer active"):(0,n.t)("Release Created")}),(0,Z.tZ)(z,{children:(0,Z.tZ)(y.Z,{date:e.activity.dateAdded})})]})}function S(){return(0,Z.tZ)(R,{icon:(0,Z.tZ)(A,{color:"white",size:"lg"}),iconColor:"gray500",hideConnector:!0,children:(0,Z.tZ)(N,{children:(0,n.t)("Waiting for new issues in this release to notify release participants ...")})})}function k(e){return(0,Z.BX)(R,{icon:(0,Z.tZ)(A,{color:"white",size:"lg"}),iconColor:"gray500",children:[(0,Z.tZ)("div",{children:(0,n.t)("Deployed to %s",e.activity.data.environment)}),(0,Z.tZ)(z,{children:(0,Z.tZ)(y.Z,{date:e.activity.dateAdded})})]})}function L(e){const t=(0,o.Z)(),s=e.activity.data.group;return(0,Z.tZ)(R,{icon:(0,Z.tZ)(x.qV,{color:"white",size:"lg"}),iconColor:"yellow300",children:(0,Z.BX)(I,{children:[(0,Z.tZ)(f.Z,{organization:t,data:s,query:"",size:"normal",includeLink:!0,hideLevel:!0}),(0,Z.tZ)(v.Z,{data:s,showInboxTime:!1})]})})}function D(e){switch(e.activity.type){case C.CREATED:case C.FINISHED:return(0,Z.tZ)(q,{activity:e.activity});case C.DEPLOYED:return(0,Z.tZ)(k,{activity:e.activity});case C.ISSUE:return(0,Z.tZ)(L,{activity:e.activity});default:return null}}!function(e){e.CREATED="CREATED",e.DEPLOYED="DEPLOYED",e.FINISHED="FINISHED",e.ISSUE="ISSUE"}(C||(C={})),q.displayName="ReleaseActivityStartStop",S.displayName="ReleaseActivityWaiting",k.displayName="ReleaseActivityDeploy",L.displayName="ReleaseIssueActivity";const z=(0,l.Z)("div",{target:"e1kkwqrg3"})("color:",(e=>e.theme.subText),";font-size:",(e=>e.theme.fontSizeMedium),";"),A=(0,l.Z)(x.iW,{target:"e1kkwqrg2"})("margin-top:-",(0,p.Z)(.5),";"),I=(0,l.Z)("div",{target:"e1kkwqrg1"})("overflow:hidden;flex:1;margin-top:",(0,p.Z)(.75),";"),N=(0,l.Z)("div",{target:"e1kkwqrg0"})("padding:",(0,p.Z)(1.5)," 0;");function O(){var e;const t=(0,h.U)(),{project:s}=(0,d.useContext)(g.ReleaseContext),{data:a,renderComponent:i}=(0,m.Z)({endpoints:[["activities",`/projects/${t.orgId}/${s.slug}/releases/${t.release}/activity/`]]});(0,d.useEffect)((()=>{var e;const t=null===(e=a.activities)||void 0===e?void 0:e.filter((e=>e.type===C.ISSUE)).map((e=>e.data.group));return c.Z.add(null!=t?t:[]),()=>{c.Z.reset()}}),[a.activities]);const r=null!==(e=a.activities)&&void 0!==e?e:[],n=r.some((e=>e.type===C.FINISHED));return i((0,Z.tZ)(u.uT,{children:(0,Z.tZ)(u.or,{fullWidth:!0,children:(0,Z.BX)(T,{children:[r.map(((e,t)=>(0,Z.tZ)(D,{activity:e},t))),n?null:(0,Z.tZ)(S,{})]})})}))}const T=(0,l.Z)("div",{target:"esitzv90"})("display:flex;flex-direction:column;gap:",(0,p.Z)(4),";");function F(){const e=(0,o.Z)();return(0,Z.tZ)(a.Z,{features:["organizations:active-release-monitor-alpha"],organization:e,renderDisabled:()=>(0,Z.tZ)(i.Z,{alert:r.aU,features:["organizations:active-release-monitor-alpha"],featureName:(0,n.t)("Active Release Details")}),children:(0,Z.tZ)(O,{})})}F.displayName="ReleaseDetailsActivity";const P=F},"../node_modules/lodash/_baseMean.js":(e,t,s)=>{var a=s("../node_modules/lodash/_baseSum.js");e.exports=function(e,t){var s=null==e?0:e.length;return s?a(e,t)/s:NaN}},"../node_modules/lodash/_baseSum.js":e=>{e.exports=function(e,t){for(var s,a=-1,i=e.length;++a<i;){var r=t(e[a]);void 0!==r&&(s=void 0===s?r:s+r)}return s}},"../node_modules/lodash/mean.js":(e,t,s)=>{var a=s("../node_modules/lodash/_baseMean.js"),i=s("../node_modules/lodash/identity.js");e.exports=function(e){return a(e,i)}}}]);
//# sourceMappingURL=../sourcemaps/app_views_releases_detail_activity_index_tsx-node_modules_lodash_mean_js.7f3e68239128c970ea1b0d7b2e3e554c.js.map