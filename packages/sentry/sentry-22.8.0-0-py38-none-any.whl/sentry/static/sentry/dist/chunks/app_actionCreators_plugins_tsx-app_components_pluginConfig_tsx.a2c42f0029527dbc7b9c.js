"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{Cg:()=>c,MM:()=>d,rR:()=>u}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=s("./app/actionCreators/indicator.tsx"),i=s("./app/actions/pluginActions.tsx"),a=s("./app/api.tsx"),o=s("./app/locale.tsx");const l={},r=new a.KU;function p(t){let{orgId:e,projectId:s,pluginId:n,update:a,...o}=t;i.Z.update(n,a);const l=r.requestPromise(`/projects/${e}/${s}/plugins/${n}/`,{...o});return l.then((()=>{i.Z.updateSuccess(n,a)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");i.Z.updateError(n,a,e)})),l}function d(t,e){let{orgId:s,projectId:n}=t;const a=`/projects/${s}/${n}/plugins/`;if(l[a])return l[a];i.Z.fetchAll(e);const o=r.requestPromise(a,{method:"GET",includeAllArgs:!0});return l[a]=o,o.then((t=>{let[e,s,n]=t;return i.Z.fetchAllSuccess(e,{pageLinks:null==n?void 0:n.getResponseHeader("Link")}),e})).catch((t=>{throw i.Z.fetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>l[a]=null)),o}function c(t){return(0,n.E3)((0,o.t)("Enabling...")),p({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,o.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to enable plugin"))))}function u(t){return(0,n.E3)((0,o.t)("Disabling...")),p({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,o.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to disable plugin"))))}},"./app/actions/pluginActions.tsx":(t,e,s)=>{s.d(e,{Z:()=>n});const n=(0,s("../node_modules/reflux/src/index.js").createActions)(["update","updateError","updateSuccess","fetchAll","fetchAllSuccess","fetchAllError"])},"./app/components/pluginConfig.tsx":(t,e,s)=>{s.d(e,{Z:()=>P});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),o=s("../node_modules/lodash/isEqual.js"),l=s.n(o),r=s("./app/actionCreators/indicator.tsx"),p=s("./app/components/button.tsx"),d=s("./app/components/loadingIndicator.tsx"),c=s("./app/components/panels/index.tsx"),u=s("./app/locale.tsx"),g=s("./app/plugins/index.tsx"),h=s("./app/plugins/components/pluginIcon.tsx"),m=s("./app/styles/space.tsx"),b=s("./app/utils/withApi.tsx"),Z=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");class x extends a.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{loading:!g.ZP.isLoaded(this.props.data),testResults:""}),(0,n.Z)(this,"handleDisablePlugin",(()=>{this.props.onDisablePlugin(this.props.data)})),(0,n.Z)(this,"handleTestPlugin",(async()=>{this.setState({testResults:""}),(0,r.E3)((0,u.t)("Sending test..."));try{const t=await this.props.api.requestPromise(this.getPluginEndpoint(),{method:"POST",data:{test:!0}});this.setState({testResults:JSON.stringify(t.detail)}),(0,r.S9)((0,u.t)("Test Complete!"))}catch(t){(0,r.Iw)((0,u.t)("An unexpected error occurred while testing your plugin. Please try again."))}}))}componentDidMount(){this.loadPlugin(this.props.data)}UNSAFE_componentWillReceiveProps(t){this.loadPlugin(t.data)}shouldComponentUpdate(t,e){return!l()(e,this.state)||!l()(t.data,this.props.data)}loadPlugin(t){this.setState({loading:!0},(()=>{g.ZP.load(t,(()=>{this.setState({loading:!1})}))}))}getPluginEndpoint(){const{organization:t,project:e,data:s}=this.props;return`/projects/${t.slug}/${e.slug}/plugins/${s.id}/`}createMarkup(){return{__html:this.props.data.doc}}render(){const{data:t}=this.props,e=void 0!==this.props.enabled?this.props.enabled:t.enabled;return(0,Z.BX)(c.s_,{className:`plugin-config ref-plugin-config-${t.id}`,"data-test-id":"plugin-config",children:[(0,Z.BX)(c.V9,{hasButtons:!0,children:[(0,Z.BX)(f,{children:[(0,Z.tZ)(j,{pluginId:t.id}),(0,Z.tZ)("span",{children:t.name})]}),t.canDisable&&e&&(0,Z.BX)(S,{children:[t.isTestable&&(0,Z.tZ)(w,{onClick:this.handleTestPlugin,size:"sm",children:(0,u.t)("Test Plugin")}),(0,Z.tZ)(p.ZP,{size:"sm",onClick:this.handleDisablePlugin,children:(0,u.t)("Disable")})]})]}),"beta"===t.status&&(0,Z.tZ)(c.aU,{type:"warning",children:(0,u.t)("This plugin is considered beta and may change in the future.")}),""!==this.state.testResults&&(0,Z.BX)(c.aU,{type:"info",children:[(0,Z.tZ)("strong",{children:"Test Results"}),(0,Z.tZ)("div",{children:this.state.testResults})]}),(0,Z.BX)(y,{children:[(0,Z.tZ)("div",{dangerouslySetInnerHTML:this.createMarkup()}),this.state.loading?(0,Z.tZ)(d.Z,{}):g.ZP.get(t).renderSettings({organization:this.props.organization,project:this.props.project})]})]})}}x.displayName="PluginConfig",(0,n.Z)(x,"defaultProps",{onDisablePlugin:()=>{}});const P=(0,b.Z)(x),f=(0,i.Z)("div",{target:"e1kqgtma4"})({name:"y37upr",styles:"display:flex;align-items:center;flex:1"}),j=(0,i.Z)(h.ZP,{target:"e1kqgtma3"})("margin-right:",(0,m.Z)(1),";"),S=(0,i.Z)("div",{target:"e1kqgtma2"})({name:"zjik7",styles:"display:flex"}),w=(0,i.Z)(p.ZP,{target:"e1kqgtma1"})("margin-right:",(0,m.Z)(1),";"),y=(0,i.Z)(c.N,{target:"e1kqgtma0"})("padding:",(0,m.Z)(2),";padding-bottom:0;")}}]);
//# sourceMappingURL=../sourcemaps/app_actionCreators_plugins_tsx-app_components_pluginConfig_tsx.4174d5a72b4c23461230f1a873132e51.js.map