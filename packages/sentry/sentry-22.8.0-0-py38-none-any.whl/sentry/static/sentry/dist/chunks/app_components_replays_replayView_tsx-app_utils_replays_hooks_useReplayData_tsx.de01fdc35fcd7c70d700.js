"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_replays_replayView_tsx-app_utils_replays_hooks_useReplayData_tsx"],{"./app/components/replays/player/scrubber.tsx":(e,t,r)=>{r.d(t,{i:()=>x,M:()=>f});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=r("./app/components/forms/controls/rangeSlider/index.tsx"),a=r("./app/components/forms/controls/rangeSlider/sliderAndInputWrapper.tsx");const o=(0,s.Z)("div",{target:"e1f3gzxp1"})({name:"1pv11yg",styles:"position:relative;height:100%;width:100%;pointer-events:none"}),i=(0,s.Z)("span",{target:"e1f3gzxp0"})("position:absolute;height:100%;width:",(e=>100*e.percent),"%;pointer-events:none;");var l=r("./app/components/replays/replayContext.tsx"),d=r("./app/components/replays/utils.tsx"),c=r("./app/styles/space.tsx"),u=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function p(e){let{className:t}=e;const{currentHoverTime:r,currentTime:s,replay:n,setCurrentTime:a}=(0,l.M)(),o=null==n?void 0:n.getDurationMs(),i=(0,d.cs)(s,o),c=(0,d.cs)(r||0,o);return(0,u.BX)(v,{className:t,children:[(0,u.BX)(m,{children:[r?(0,u.tZ)(y,{percent:c}):null,(0,u.tZ)(b,{percent:i})]}),(0,u.tZ)(h,{children:(0,u.tZ)(g,{name:"replay-timeline",min:0,max:o,value:Math.round(s),onChange:e=>a(e||0),showLabel:!1})})]})}p.displayName="Scrubber";const m=(0,s.Z)(o,{target:"e138nie77"})("background:",(e=>e.theme.gray200),";"),h=(0,s.Z)("div",{target:"e138nie76"})({name:"1aubja5",styles:"overflow:hidden;width:100%"}),g=(0,s.Z)(n.Z,{target:"e138nie75"})({name:"rjtouz",styles:"input{cursor:pointer;opacity:0;height:100%;&::-webkit-slider-thumb{height:0px;width:0px;}&::-moz-range-thumb{height:0px;width:0px;}&::-ms-thumb{height:0px;width:0px;}}"}),b=(0,s.Z)(i,{target:"e138nie74"})(""),y=(0,s.Z)(i,{target:"e138nie73"})(""),v=(0,s.Z)("div",{target:"e138nie72"})({name:"1n0uila",styles:"position:relative;width:100%;&>*{position:absolute;top:0;left:0;}"}),f=(0,s.Z)(p,{target:"e138nie71"})("height:100%;",m,"{background:transparent;}",h,",",g,",",a.Z,"{height:100%;}",b,"{background:",(e=>e.theme.purple100),';border-top-left-radius:3px;border-bottom-left-radius:3px;}/**\n   * Draw lines so users can see the currenTime & their mouse position\n   * "----|----|--------------------- duration = 1:00"\n   *      ^    ^\n   *      |    PlaybackTimeValue @ 20s\n   *      MouseTrackingValue @ 10s\n   */',b,",",y,"{border-right:",(0,c.Z)(.25)," solid ",(e=>e.theme.purple300),";}"),x=(0,s.Z)(p,{target:"e138nie70"})("height:",(0,c.Z)(.5),";:hover{margin-block:-",(0,c.Z)(.25),";height:",(0,c.Z)(1),";}",m,"{border-radius:",(e=>e.theme.borderRadiusBottom),";}",h,"{height:",(0,c.Z)(.5),";}:hover ",h,"{height:",(0,c.Z)(.75),";}",b,"{background:",(e=>e.theme.purple200),";border-bottom-left-radius:",(e=>e.theme.borderRadius),';}/**\n   * Draw the circle (appears on hover) to mark the currentTime of the video\n   * "---------o-------------------- duration = 1:00"\n   *           ^\n   *           PlaybackTimeValue @ 20s\n   */',b,":after{content:'';display:block;width:",(0,c.Z)(2),";height:",(0,c.Z)(2),";z-index:",(e=>e.theme.zIndex.initial),";pointer-events:none;background:",(e=>e.theme.purple300),";box-sizing:content-box;border-radius:",(0,c.Z)(2),";border:solid ",(e=>e.theme.white),";border-width:",(0,c.Z)(.5),";position:absolute;top:-",(0,c.Z)(1),";right:-",(0,c.Z)(1.5),";opacity:0;transition:opacity 0.1s ease;}:hover ",b,':after{opacity:1;}/*\n   * Draw a square so users can see their mouse position when it is left or right of the currentTime\n   * "----â–¡----o--------------------- duration = 1:00"\n   *      ^    ^\n   *      |    PlaybackTimeValue @ 20s\n   *      MouseTrackingValue @ 10s\n   */',y,":after{content:'';display:block;width:",(0,c.Z)(.5),";height:",(0,c.Z)(1.5),";pointer-events:none;background:",(e=>e.theme.purple200),";box-sizing:content-box;position:absolute;top:-",(0,c.Z)(.5),";right:-1px;}:hover ",y,":after{height:",(0,c.Z)(2),";top:-",(0,c.Z)(.5),";}")},"./app/components/replays/player/scrubberMouseTracking.tsx":(e,t,r)=>{r.d(t,{Z:()=>l});var s=r("../node_modules/react/index.js"),n=r("./app/components/replays/replayContext.tsx"),a=r("./app/utils/replays/hooks/useMouseTracking.tsx"),o=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function i(e){let{children:t}=e;const{replay:r,setCurrentHoverTime:i}=(0,n.M)(),l=null==r?void 0:r.getDurationMs(),d=(0,s.useCallback)((e=>{if(!e||void 0===l)return void i(void 0);const{left:t,width:r}=e;i(t>=0?t/r*l:void 0)}),[l,i]),c=(0,a.Z)({onPositionChange:d});return(0,o.tZ)("div",{...c,children:t})}i.displayName="ScrubberMouseTracking";const l=i},"./app/components/replays/replayView.tsx":(e,t,r)=>{r.d(t,{Z:()=>K});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),n=r("../node_modules/react/index.js"),a=r("./app/components/replays/player/scrubber.tsx"),o=r("./app/components/replays/player/scrubberMouseTracking.tsx"),i=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/@react-aria/utils/dist/module.js")),l=r("./app/components/button.tsx"),d=r("./app/components/buttonBar.tsx"),c=r("./app/components/forms/compositeSelect.tsx"),u=r("./app/components/replays/replayContext.tsx"),p=r("./app/components/replays/utils.tsx"),m=r("./app/icons/index.tsx"),h=r("./app/locale.tsx"),g=r("./app/styles/space.tsx"),b=r("./app/types/breadcrumbs.tsx"),y=r("./app/utils/replays/getBreadcrumb.tsx"),v=r("./app/utils/replays/hooks/useFullscreen.tsx"),f=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const x=[b.kS.ERROR,b.kS.INIT,b.kS.NAVIGATION,b.kS.UI,b.kS.USER];function Z(e){let{isCompact:t}=e;const{currentTime:r,isFinished:s,isPlaying:n,replay:a,restart:o,setCurrentTime:i,togglePlayPause:c}=(0,u.M)();return(0,f.BX)(d.ZP,{merged:!0,children:[!t&&(0,f.tZ)(l.ZP,{size:"sm",title:(0,h.t)("Rewind 10s"),icon:(0,f.tZ)(m.A0,{size:"sm"}),onClick:()=>i(r-1e4),"aria-label":(0,h.t)("Rewind 10 seconds")}),s?(0,f.tZ)(l.ZP,{size:"sm",title:(0,h.t)("Restart Replay"),icon:(0,f.tZ)(m.sm,{size:"sm"}),onClick:o,"aria-label":(0,h.t)("Restart Replay")}):(0,f.tZ)(l.ZP,{size:"sm",title:n?(0,h.t)("Pause"):(0,h.t)("Play"),icon:n?(0,f.tZ)(m.ky,{size:"sm"}):(0,f.tZ)(m.JF,{size:"sm"}),onClick:()=>c(!n),"aria-label":n?(0,h.t)("Pause"):(0,h.t)("Play")}),!t&&(0,f.tZ)(l.ZP,{size:"sm",title:(0,h.t)("Next breadcrumb"),icon:(0,f.tZ)(m.pi,{size:"sm"}),onClick:()=>{var e;const t=null==a||null===(e=a.getReplay().startedAt)||void 0===e?void 0:e.getTime();if(!t)return;const s=(null==a?void 0:a.getRawCrumbs())||[],n=(0,y.q)({crumbs:s.filter((e=>x.includes(e.type))),targetTimestampMs:t+r});void 0!==t&&null!=n&&n.timestamp&&i((0,p.NH)(n.timestamp,t))},"aria-label":(0,h.t)("Fast-forward to next breadcrumb")})]})}function w(){const{currentTime:e,replay:t}=(0,u.M)(),r=null==t?void 0:t.getDurationMs();return(0,f.BX)("span",{children:[(0,p.mr)(e)," / ",r?(0,p.mr)(r):"--:--"]})}function k(e){let{speedOptions:t}=e;const{setSpeed:r,speed:s,isSkippingInactive:n,toggleSkipInactive:a}=(0,u.M)(),o="skip";return(0,f.tZ)(c.Z,{placement:"bottom",trigger:e=>{let{props:t,ref:r}=e;return(0,f.tZ)(l.ZP,{ref:r,...t,size:"sm",title:(0,h.t)("Settings"),"aria-label":(0,h.t)("Settings"),icon:(0,f.tZ)(m.iC,{size:"sm"})})},sections:[{defaultValue:s,label:(0,h.t)("Playback Speed"),value:"playback_speed",onChange:r,options:t.map((e=>({label:`${e}x`,value:e})))},{multiple:!0,defaultValue:n?o:void 0,label:"",value:"fast_forward",onChange:e=>{a(e.length>0)},options:[{label:(0,h.t)("Fast-forward inactivity"),value:o}]}]})}Z.displayName="ReplayPlayPauseBar",w.displayName="ReplayCurrentTime",k.displayName="ReplayOptionsMenu";const S=e=>{let{toggleFullscreen:t=(()=>{}),speedOptions:r=[.1,.25,.5,1,2,4]}=e;const s=(0,n.useRef)(null),[a,o]=(0,n.useState)(0),{isFullscreen:d}=(0,v.Z)(),c=(0,n.useCallback)((()=>{var e,t;const{width:r}=null!==(e=null===(t=s.current)||void 0===t?void 0:t.getBoundingClientRect())&&void 0!==e?e:{width:500};o(r<400?1:0)}),[]);return(0,i.yU)({ref:s,onResize:c}),(0,n.useLayoutEffect)((()=>c),[c]),(0,f.BX)(j,{ref:s,children:[(0,f.tZ)(Z,{isCompact:a>0}),(0,f.tZ)(w,{}),(0,f.tZ)(k,{speedOptions:r}),(0,f.tZ)(l.ZP,{size:"sm",title:d?(0,h.t)("Exit full screen"):(0,h.t)("Enter full screen"),"aria-label":d?(0,h.t)("Exit full screen"):(0,h.t)("Enter full screen"),icon:d?(0,f.tZ)(m.pC,{size:"sm"}):(0,f.tZ)(m.qp,{size:"sm"}),onClick:t})]})};S.displayName="ReplayControls";const j=(0,s.Z)("div",{target:"e1ryc6sl0"})("display:grid;grid-column-gap:",(0,g.Z)(1),";grid-template-columns:max-content auto max-content max-content;align-items:center;"),M=S;var T=r("./app/components/forms/textCopyInput.tsx"),I=(r("../node_modules/core-js/modules/web.url.js"),r("../node_modules/core-js/modules/web.url-search-params.js"),r("../node_modules/lodash/last.js")),R=r.n(I);const E=function(e,t,r){var s,n;const a=e.startedAt.getTime()+Math.floor(r),o=t.filter((e=>e.type===b.kS.NAVIGATION)),i=e.tags.url,l=i?new URL(i).origin:"",d=null===(s=R()(o.filter((e=>{let{timestamp:t}=e;return+new Date(t||0)<a}))))||void 0===s||null===(n=s.data)||void 0===n?void 0:n.to;if(!d)return i;try{const e=new URL(d);return String(e)}catch{return l+d}};function N(){const{currentTime:e,replay:t}=(0,u.M)();if(!t)return(0,f.tZ)(C,{disabled:!0,children:""});const r=t.getReplay(),s=t.getRawCrumbs();return(0,f.tZ)(C,{children:E(r,s,e)})}N.displayName="ReplayCurrentUrl";const C=(0,s.Z)(T.ZP,{target:"evzcn0b0"})("font-size:",(e=>e.theme.fontSizeMedium),";"),z=N;function D(e){let{className:t}=e;return(0,f.tZ)(P,{className:t,children:(0,f.BX)(_,{children:[(0,f.tZ)(m.jo,{size:"sm"}),(0,h.t)("Buffering...")]})})}D.displayName="BufferingOverlay";const P=(0,s.Z)("div",{target:"e1tth60i1"})({name:"1p9eycc",styles:"user-select:none;display:grid;place-items:center"}),_=(0,s.Z)("div",{target:"e1tth60i0"})("display:grid;grid-template-columns:max-content max-content;gap:",(0,g.Z)(.75),";place-items:center;padding:",(0,g.Z)(3),";background:",(e=>e.theme.gray300),";border-radius:",(e=>e.theme.borderRadius),";color:",(e=>e.theme.white),";z-index:",(e=>e.theme.zIndex.initial),";"),A=D;var O=r("./app/components/tooltip.tsx");function B(e){let{speed:t,className:r}=e;return(0,f.tZ)(F,{className:r,children:(0,f.BX)(L,{title:(0,h.t)("Fast forwarding"),children:[(0,f.tZ)(m.CC,{size:"sm",direction:"right"}),t,"x"]})})}B.displayName="FastForwardBadge";const F=(0,s.Z)("div",{target:"e1135tm81"})({name:"8y7axy",styles:"user-select:none;display:grid;align-items:end;justify-items:start"}),L=(0,s.Z)(O.Z,{target:"e1135tm80"})("display:grid;grid-template-columns:max-content max-content;gap:",(0,g.Z)(.5),";align-items:center;background:",(e=>e.theme.gray300),";color:",(e=>e.theme.white),";padding:",(0,g.Z)(1.5)," ",(0,g.Z)(2),";border-top-right-radius:",(e=>e.theme.borderRadius),";z-index:",(e=>e.theme.zIndex.initial),";"),U=B;function V(e){let{className:t}=e;const{initRoot:r,dimensions:s,fastForwardSpeed:a,isBuffering:o}=(0,u.M)(),l=(0,n.useRef)(null),d=(0,n.useRef)(null),[c,p]=(0,n.useState)({width:0,height:0});(0,n.useEffect)((()=>r(d.current)),[r]);const m=(0,n.useCallback)((()=>{var e,t;return p({width:(null===(e=l.current)||void 0===e?void 0:e.clientWidth)||0,height:(null===(t=l.current)||void 0===t?void 0:t.clientHeight)||0})}),[p]);return(0,i.yU)({ref:l,onResize:m}),(0,n.useEffect)((()=>{void 0===window.ResizeObserver&&m()}),[m]),(0,n.useEffect)((()=>{if(d.current){const e=Math.min(c.width/s.width,c.height/s.height,1);e&&(d.current.style["transform-origin"]="top left",d.current.style.transform=`scale(${e})`,d.current.style.width=s.width*e+"px",d.current.style.height=s.height*e+"px")}}),[c,s]),(0,f.BX)(G,{ref:l,className:"sr-block",children:[(0,f.tZ)("div",{ref:d,className:t}),a?(0,f.tZ)(X,{speed:a}):null,o?(0,f.tZ)(J,{}):null]})}V.displayName="BasePlayerRoot";const G=(0,s.Z)("div",{target:"elabtru4"})("width:100%;display:flex;flex-grow:1;justify-content:center;align-items:center;position:relative;overflow:hidden;background-color:",(e=>e.theme.backgroundSecondary),";background-image:repeating-linear-gradient(\n      -145deg,\n      transparent,\n      transparent 8px,\n      ",(e=>e.theme.backgroundSecondary)," 8px,\n      ",(e=>e.theme.backgroundSecondary)," 11px\n    ),repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent 15px,\n      ",(e=>e.theme.gray100)," 15px,\n      ",(e=>e.theme.gray100)," 16px\n    );"),X=(0,s.Z)(U,{target:"elabtru3"})({name:"m4y3yb",styles:"position:absolute;left:0;bottom:0"}),J=(0,s.Z)(A,{target:"elabtru2"})({name:"j2pfbl",styles:"position:absolute;top:0;left:0;right:0;bottom:0"}),$=(0,s.Z)(V,{target:"elabtru1"})({name:"1nx655q",styles:".replayer-wrapper{user-select:none;}.replayer-wrapper>.replayer-mouse-tail{position:absolute;pointer-events:none;}.replayer-wrapper>iframe{border:none;background:white;}"}),W=(0,s.Z)($,{target:"elabtru0"})(".replayer-mouse{position:absolute;width:32px;height:32px;transition:left 0.05s linear,top 0.05s linear;background-size:contain;background-repeat:no-repeat;background-image:url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTkiIHZpZXdCb3g9IjAgMCAxMiAxOSIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTAgMTZWMEwxMS42IDExLjZINC44TDQuNCAxMS43TDAgMTZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNOS4xIDE2LjdMNS41IDE4LjJMMC43OTk5OTkgNy4xTDQuNSA1LjZMOS4xIDE2LjdaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNNC42NzQ1MSA4LjYxODUxTDIuODMwMzEgOS4zOTI3MUw1LjkyNzExIDE2Ljc2OTVMNy43NzEzMSAxNS45OTUzTDQuNjc0NTEgOC42MTg1MVoiIGZpbGw9ImJsYWNrIi8+CjxwYXRoIGQ9Ik0xIDIuNFYxMy42TDQgMTAuN0w0LjQgMTAuNkg5LjJMMSAyLjRaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K');border-color:transparent;}.replayer-mouse:after{content:'';display:inline-block;width:32px;height:32px;background:",(e=>e.theme.purple300),";border-radius:100%;transform:translate(-50%, -50%);opacity:0.3;}.replayer-mouse.active:after{animation:click 0.2s ease-in-out 1;}.replayer-mouse.touch-device{background-image:none;width:70px;height:70px;border-radius:100%;margin-left:-37px;margin-top:-37px;border:4px solid rgba(73, 80, 246, 0);transition:left 0s linear,top 0s linear,border-color 0.2s ease-in-out;}.replayer-mouse.touch-device.touch-active{border-color:",(e=>e.theme.purple200),";transition:left 0.25s linear,top 0.25s linear,border-color 0.2s ease-in-out;}.replayer-mouse.touch-device:after{opacity:0;}.replayer-mouse.touch-device.active:after{animation:touch-click 0.2s ease-in-out 1;}@keyframes click{0%{opacity:0.3;width:20px;height:20px;}50%{opacity:0.5;width:10px;height:10px;}}@keyframes touch-click{0%{opacity:0;width:20px;height:20px;}50%{opacity:0.5;width:10px;height:10px;}}");var q=r("./app/views/replays/detail/layout/fluidHeight.tsx");function H(e){let{toggleFullscreen:t,showAddressBar:r=!0}=e;return(0,f.BX)(n.Fragment,{children:[r&&(0,f.tZ)(z,{}),(0,f.BX)(Q,{children:[(0,f.tZ)(Y,{children:(0,f.tZ)(W,{})}),(0,f.tZ)(o.Z,{children:(0,f.tZ)(a.i,{})})]}),(0,f.tZ)(M,{toggleFullscreen:t})]})}H.displayName="ReplayView";const Q=(0,s.Z)(q.Z,{target:"e185m34i1"})("padding-bottom:",(0,g.Z)(1),";margin-bottom:-",(0,g.Z)(1),";"),Y=(0,s.Z)(q.Z,{target:"e185m34i0"})("background:",(e=>e.theme.background),";border-radius:",(e=>e.theme.borderRadiusTop),";border:1px solid ",(e=>e.theme.border),";border-bottom:none;box-shadow:",(e=>e.theme.dropShadowLight),";"),K=H},"./app/utils/replays/getBreadcrumb.tsx":(e,t,r)=>{function s(e){let{crumbs:t,targetTimestampMs:r,allowExact:s=!1}=e;return t.reduce(((e,t)=>{const n=+new Date(t.timestamp||"");return n>r||!s&&n===r?e:!e||n>+new Date(e.timestamp||"")?t:e}),void 0)}function n(e){let{crumbs:t,targetTimestampMs:r,allowExact:s=!1}=e;return t.reduce(((e,t)=>{const n=+new Date(t.timestamp||"");return n<r||!s&&n===r?e:!e||n<+new Date(e.timestamp||"")?t:e}),void 0)}r.d(t,{F:()=>s,q:()=>n})},"./app/utils/replays/hooks/useFullscreen.tsx":(e,t,r)=>{r.d(t,{Z:()=>a}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=r("../node_modules/react/index.js"),n=r("../node_modules/screenfull/index.js");function a(){const e=(0,s.useRef)(null),[t,r]=(0,s.useState)(!1),a=(0,s.useCallback)((async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{navigationUI:"auto"};n.Z.isEnabled&&e.current&&await n.Z.request(e.current,t)}),[]),o=(0,s.useCallback)((async()=>{n.Z.isEnabled&&await n.Z.exit()}),[]),i=(0,s.useCallback)((()=>t?o():a()),[a,o,t]),l=()=>{r(n.Z.isFullscreen)};return(0,s.useEffect)((()=>(n.Z.on("change",l),()=>n.Z.off("change",l))),[]),{enter:a,exit:o,isEnabled:n.Z.isEnabled,isFullscreen:t,ref:e,toggle:i}}},"./app/utils/replays/hooks/useMouseTracking.tsx":(e,t,r)=>{r.d(t,{Z:()=>o}),r("../node_modules/core-js/modules/es.error.cause.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=r("../node_modules/react/index.js"),n=r("../node_modules/@sentry/hub/esm/exports.js");class a extends Error{}const o=function(e){let{onPositionChange:t,onMouseEnter:r,onMouseMove:o,onMouseLeave:i,...l}=e;const d=(0,s.useRef)(null),c=(0,s.useRef)(new AbortController),u=(0,s.useCallback)((async e=>{if(d.current)try{const r=await function(e,t){let{signal:r}=t;return new Promise(((t,s)=>{r.aborted&&s(new a);const n=()=>{s(new a)},o=new IntersectionObserver((e=>{for(const s of e){const e=s.boundingClientRect;t(e),r.removeEventListener("abort",n)}o.disconnect()}));r.addEventListener("abort",n),o.observe(e)}))}(d.current,{signal:c.current.signal});t({height:r.height,left:Math.min(e.clientX-r.left,r.width),top:Math.min(e.clientY-r.top,r.height),width:r.width})}catch(e){if(e instanceof a)return;n.Tb(e)}else t(void 0)}),[t,c]),p=(0,s.useCallback)((()=>{c.current&&(c.current.abort(),c.current=new AbortController),t(void 0)}),[t,c]);return{ref:d,...l,onMouseEnter:e=>{u(e),null==r||r(e)},onMouseMove:e=>{u(e),null==o||o(e)},onMouseLeave:e=>{p(),null==i||i(e)}}}},"./app/utils/replays/hooks/useReplayData.tsx":(e,t,r)=>{r.d(t,{Z:()=>f}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=r("../node_modules/react/index.js"),n=r("../node_modules/@sentry/hub/esm/exports.js"),a=r("../node_modules/pako/dist/pako.esm.mjs");r("../node_modules/core-js/modules/es.error.cause.js");var o=r("./app/utils/replays/hooks/useDiscoveryQuery.tsx"),i=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),l=(r("../node_modules/core-js/modules/es.array.includes.js"),r("./app/types/breadcrumbs.tsx")),d=r("../node_modules/lodash/first.js"),c=r.n(d),u=r("./app/components/events/interfaces/breadcrumbs/utils.tsx"),p=r("./app/locale.tsx");class m{static factory(e){let{breadcrumbs:t,event:r,errors:s,rrwebEvents:n,spans:a}=e;return t&&r&&n&&a&&s?new m({breadcrumbs:t,event:r,errors:s,rrwebEvents:n,spans:a}):null}constructor(e){var t,r,s,n,a,o;let{breadcrumbs:d,event:m,errors:h,rrwebEvents:g,spans:b}=e;(0,i.Z)(this,"event",void 0),(0,i.Z)(this,"replayRecord",void 0),(0,i.Z)(this,"rrwebEvents",void 0),(0,i.Z)(this,"breadcrumbs",void 0),(0,i.Z)(this,"spans",void 0),(0,i.Z)(this,"getEvent",(()=>this.event)),(0,i.Z)(this,"getDurationMs",(()=>this.replayRecord.duration)),(0,i.Z)(this,"getReplay",(()=>this.replayRecord)),(0,i.Z)(this,"getRRWebEvents",(()=>this.rrwebEvents)),(0,i.Z)(this,"getRawCrumbs",(()=>this.breadcrumbs)),(0,i.Z)(this,"getRawSpans",(()=>this.spans)),(0,i.Z)(this,"isMemorySpan",(e=>"memory"===e.op)),(0,i.Z)(this,"isNetworkSpan",(e=>!this.isMemorySpan(e)&&!e.op.includes("paint")));const{startTimestampMs:y,endTimestampMs:v}=function(e,t,r){const s=e.map((e=>e.timestamp)),n=t.map((e=>e.timestamp)).filter(Boolean).map((e=>+new Date(1e3*e))),a=r.map((e=>1e3*e.startTimestamp)),o=r.map((e=>1e3*e.endTimestamp));return{startTimestampMs:Math.min(...s,...n,...a),endTimestampMs:Math.max(...s,...n,...o)}}(g,d,b);this.spans=function(e){return e.sort(((e,t)=>e.startTimestamp-t.startTimestamp))}(b),this.breadcrumbs=function(e,t,r,s,n){var a;const{tags:o}=t,i=null===(a=o.find((e=>"url"===e.key)))||void 0===a?void 0:a.value,d={type:l.kS.INIT,timestamp:new Date(e).toISOString(),level:l.nU.INFO,message:i,data:{action:"replay-init",label:(0,p.t)("Start recording"),url:i}},c=r.map((e=>({type:l.kS.ERROR,level:l.nU.ERROR,category:"exception",message:e["error.value"],data:{label:e["error.type"]},timestamp:e.timestamp}))),m=n.filter((e=>["navigation.navigate","navigation.reload","largest-contentful-paint"].includes(e.op))).map((e=>{if(e.op.startsWith("navigation")){const[,t]=e.op.split(".");return{category:"default",type:l.kS.NAVIGATION,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,message:e.description,action:t,data:{to:e.description,label:"reload"===t?(0,p.t)("Reload"):"navigate"===t?(0,p.t)("Page load"):(0,p.t)("Navigation"),...e.data}}}return{type:l.kS.DEBUG,timestamp:new Date(1e3*e.startTimestamp).toISOString(),level:l.nU.INFO,category:"default",data:{action:e.op,...e.data,label:"largest-contentful-paint"===e.op?(0,p.t)("LCP"):e.op}}})),h=n.find((e=>"navigation.navigate"===e.op));return(0,u.LP)([...h?[]:[d],...s.map((e=>{let{timestamp:t,...r}=e;return{...r,type:l.kS.DEFAULT,timestamp:new Date(1e3*t).toISOString()}})),...c,...m]).sort(((e,t)=>+new Date(e.timestamp||0)-+new Date(t.timestamp||0)))}(y,m,h,d,this.spans),this.rrwebEvents=function(e,t,r){const s=[].concat(r).concat({type:5,timestamp:t,data:{tag:"replay-end"}});s.sort(((e,t)=>e.timestamp-t.timestamp));const n=c()(s);return n&&(n.timestamp=e),s}(y,v,g),this.event={...m,startTimestamp:y/1e3,endTimestamp:v/1e3};const f=this.getRawCrumbs().filter((e=>e.category===l.kS.NAVIGATION)).map((e=>{var t;return null===(t=e.data)||void 0===t?void 0:t.to})).filter(Boolean);this.replayRecord={countErrors:this.getRawCrumbs().filter((e=>e.category===l.kS.ERROR)).length,countSegments:0,countUrls:f.length,errorIds:[],dist:this.event.dist,duration:v-y,environment:null,finishedAt:new Date(v),longestTransaction:0,platform:this.event.platform,projectId:this.event.projectID,projectSlug:"",release:null,replayId:this.event.id,sdkName:null===(t=this.event.sdk)||void 0===t?void 0:t.name,sdkVersion:null===(r=this.event.sdk)||void 0===r?void 0:r.version,startedAt:new Date(y),tags:this.event.tags.reduce(((e,t)=>{let{key:r,value:s}=t;return e[r]=s,e}),{}),title:this.event.title,traceIds:[],urls:f,userAgent:"",user:{email:null===(s=this.event.user)||void 0===s?void 0:s.email,id:null===(n=this.event.user)||void 0===n?void 0:n.id,ipAddress:null===(a=this.event.user)||void 0===a?void 0:a.ip_address,name:null===(o=this.event.user)||void 0===o?void 0:o.name}}}}var h=r("./app/utils/useApi.tsx");const g=/rrweb-[0-9]{13}.json/;function b(e){return g.test(e.name)}function y(e){const t={breadcrumbs:[],replaySpans:[],recording:[]};return e.forEach((e=>{var r,s;"performanceSpan"===(null===(r=e.data)||void 0===r?void 0:r.tag)?t.replaySpans.push(e.data.payload):"breadcrumb"===(null==e||null===(s=e.data)||void 0===s?void 0:s.tag)?t.breadcrumbs.push(e.data.payload):t.recording.push(e)})),t}const v=Object.freeze({errors:void 0,event:void 0,fetchError:void 0,fetching:!0,isErrorsFetching:!0,rrwebEvents:void 0,spans:void 0,breadcrumbs:void 0}),f=function(e){let{eventSlug:t,orgId:r}=e;const[i,l]=t.split(":"),d=(0,h.Z)(),[c,u]=(0,s.useState)(v),p=(0,s.useCallback)((()=>d.requestPromise(`/organizations/${r}/events/${t}/`)),[d,r,t]),g=(0,s.useCallback)((async()=>{const e=(await d.requestPromise(`/projects/${r}/${i}/events/${l}/attachments/`)).filter(b);return(await Promise.all(e.map((async e=>{const t=await d.requestPromise(`/api/0/projects/${r}/${i}/events/${l}/attachments/${e.id}/?download`,{includeAllArgs:!0});try{return y(JSON.parse(t[0]))}catch(e){}try{var s;const e=await(null===(s=t[2])||void 0===s?void 0:s.rawResponse.blob()),r=await(null==e?void 0:e.arrayBuffer());return y(JSON.parse((0,a.rr)(r,{to:"string"})))}catch(e){return{}}})))).reduce(((e,t)=>(Object.entries(t).forEach((t=>{let[r,s]=t;if(!Array.isArray(s))throw new Error("Invalid value");e[r]=(e[r]||[]).concat(s)})),e)),{})}),[d,l,r,i]),{isLoading:f,data:x}=function(e){let{replayId:t,...r}=e;const n=(0,s.useMemo)((()=>({query:`replayId:${t} AND event.type:error`,fields:["event.id","error.value","timestamp","error.type","issue.id"],environment:[],projects:[]})),[t]);return(0,o.Z)({discoverQuery:n,...r})}({replayId:l});(0,s.useEffect)((()=>{f||u((e=>({...e,fetching:e.fetching||f,isErrorsFetching:f,errors:x})))}),[f,x]);const Z=(0,s.useCallback)((async()=>{u(v);try{const[e,t]=await Promise.all([p(),g()]);u((r=>({...r,event:e,fetchError:void 0,fetching:r.isErrorsFetching||!1,rrwebEvents:t.recording,spans:t.replaySpans,breadcrumbs:t.breadcrumbs})))}catch(e){n.Tb(e),u({...v,fetchError:e,fetching:!1})}}),[p,g]);(0,s.useEffect)((()=>{Z()}),[Z]);const w=(0,s.useMemo)((()=>m.factory({event:c.event,errors:c.errors,rrwebEvents:c.rrwebEvents,breadcrumbs:c.breadcrumbs,spans:c.spans})),[c.event,c.rrwebEvents,c.breadcrumbs,c.spans,c.errors]);return{fetchError:c.fetchError,fetching:c.fetching,onRetry:Z,replay:w}}},"./app/views/replays/detail/layout/fluidHeight.tsx":(e,t,r)=>{r.d(t,{Z:()=>s});const s=(0,r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"e42v6lb0"})({name:"oie2px",styles:"display:flex;flex-direction:column;flex-wrap:nowrap;flex-grow:1;overflow:hidden"})}}]);
//# sourceMappingURL=../sourcemaps/app_components_replays_replayView_tsx-app_utils_replays_hooks_useReplayData_tsx.3bd1a2c754a1f699d2aa61f06346c966.js.map