"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_charts_eventsRequest_tsx"],{"./app/actionCreators/events.tsx":(e,t,r)=>{r.d(t,{JE:()=>u,eV:()=>d,lI:()=>l}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var s=r("../node_modules/lodash/pick.js"),a=r.n(s),o=r("./app/components/charts/utils.tsx"),i=r("./app/utils/getPeriod.tsx"),n=r("./app/utils/performance/constants.tsx");const l=(e,t)=>{var r;let{organization:s,project:a,environment:n,team:l,period:d,start:u,end:m,interval:c,comparisonDelta:p,includePrevious:h,query:g,yAxis:v,field:D,topEvents:f,orderby:b,partial:P,withoutZerofill:x,referrer:j,queryBatching:y,generatePathname:q,queryExtras:T,excludeOther:w,includeAllArgs:M}=t;const _=null!==(r=null==q?void 0:q(s))&&void 0!==r?r:`/organizations/${s.slug}/events-stats/`,Z=(0,o.Sw)(h,d),A={includeAllArgs:M,query:{...Object.fromEntries(Object.entries({interval:c,comparisonDelta:p,project:a,environment:n,team:l,query:g,yAxis:v,field:D,topEvents:f,orderby:b,partial:P?"1":void 0,withoutZerofill:x?"1":void 0,referrer:j||"api.organization-event-stats",excludeOther:w?"1":void 0}).filter((e=>{let[,t]=e;return void 0!==t}))),...(0,i.X)({period:d,start:u,end:m},{shouldDoublePeriod:Z}),...T}};return null!=y&&y.batchRequest?y.batchRequest(e,_,A):e.requestPromise(_,A)};function d(e,t,r){const s={...a()(r,Object.values(n.s)),query:r.query};return e.requestPromise(`/organizations/${t}/events-facets/`,{query:s})}function u(e,t,r){const s={...a()(r,Object.values(n.s)),query:r.query};return e.requestPromise(`/organizations/${t}/events-meta/`,{query:s}).then((e=>e.count))}},"./app/components/charts/eventsRequest.tsx":(e,t,r)=>{r.d(t,{Z:()=>P});var s=r("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),a=(r("../node_modules/core-js/modules/es.array.includes.js"),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/react/index.js")),o=r("../node_modules/lodash/isEqual.js"),i=r.n(o),n=r("../node_modules/lodash/omitBy.js"),l=r.n(n),d=r("./app/actionCreators/events.tsx"),u=r("./app/actionCreators/indicator.tsx"),m=r("./app/components/charts/loadingPanel.tsx"),c=r("./app/components/charts/utils.tsx"),p=r("./app/locale.tsx"),h=r("./app/utils.tsx"),g=r("./app/utils/discover/fields.tsx"),v=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const D=["api","children","organization","loading","queryBatching","generatePathname"],f=e=>l()(e,((e,t)=>D.includes(t)));class b extends a.PureComponent{constructor(){super(...arguments),(0,s.Z)(this,"state",{reloading:!!this.props.loading,errored:!1,timeseriesData:null,fetchedWithPrevious:!1}),(0,s.Z)(this,"unmounting",!1),(0,s.Z)(this,"fetchData",(async()=>{const{api:e,confirmedQuery:t,onError:r,expired:s,name:a,hideError:o,...i}=this.props;let n,l=null;if(!1!==t){if(this.setState((e=>({reloading:null!==e.timeseriesData,errored:!1,errorMessage:void 0}))),s)n=(0,p.t)("%s has an invalid date range. Please try a more recent date range.",a),(0,u.Iw)(n,{append:!0}),this.setState({errored:!0,errorMessage:n});else try{e.clear(),l=await(0,d.lI)(e,i)}catch(e){n=e&&e.responseJSON&&e.responseJSON.detail?e.responseJSON.detail:(0,p.t)("Error loading chart data"),o||(0,u.Iw)(n),r&&r(n),this.setState({errored:!0,errorMessage:n})}this.unmounting||(this.setState({reloading:!1,timeseriesData:l,fetchedWithPrevious:i.includePrevious}),i.dataLoadedCallback&&i.dataLoadedCallback(l))}})),(0,s.Z)(this,"getData",(e=>{const{fetchedWithPrevious:t}=this.state,{period:r,includePrevious:s}=this.props,a=t||(0,c.Sw)(s,r),o=Math.floor(e.length/2);return{current:a?e.slice(o):e,previous:a?e.slice(0,o):null}}))}componentDidMount(){this.fetchData()}componentDidUpdate(e){i()(f(e),f(this.props))||this.fetchData()}componentWillUnmount(){this.unmounting=!0}calculateTotalsPerTimestamp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e=>1e3*e;return e.map(((e,r)=>{let[s,a]=e;return{name:t(s,a,r),value:a.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}transformPreviousPeriodData(e,t,r){return t?{seriesName:null!=r?r:"Previous",data:this.calculateTotalsPerTimestamp(t,((t,r,s)=>1e3*e[s][0])),stack:"previous"}:null}transformAggregatedTimeseries(e){return{seriesName:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",data:this.calculateTotalsPerTimestamp(e)}}transformTimeseriesData(e,t){return[{seriesName:t||"Current",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{count:r}=t;return e+r}),0)}}))}]}transformComparisonTimeseriesData(e){return[{seriesName:"comparisonCount()",data:e.map((e=>{let[t,r]=e;return{name:1e3*t,value:r.reduce(((e,t)=>{let{comparisonCount:r}=t;return e+(null!=r?r:0)}),0)}}))}]}processData(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0;const{data:a,isMetricsData:o,totals:i}=e,{includeTransformedData:n,includeTimeAggregation:l,timeAggregationSeriesName:d,currentSeriesNames:u,previousSeriesNames:m,comparisonDelta:p}=this.props,{current:h,previous:g}=this.getData(a);return{data:n?this.transformTimeseriesData(h,null!=s?s:null==u?void 0:u[r]):[],comparisonData:n&&p?this.transformComparisonTimeseriesData(h):[],allData:a,originalData:h,totals:i,isMetricsData:o,originalPreviousData:g,previousData:n?this.transformPreviousPeriodData(h,g,null!==(t=s?(0,c.TE)(s):void 0)&&void 0!==t?t:null==m?void 0:m[r]):null,timeAggregatedData:l?this.transformAggregatedTimeseries(h,d||""):{},timeframe:e.start&&e.end?g?{start:500*(e.start+e.end),end:1e3*e.end}:{start:1e3*e.start,end:1e3*e.end}:void 0}}render(){const{children:e,showLoading:t,...r}=this.props,{topEvents:s}=this.props,{timeseriesData:a,reloading:o,errored:i,errorMessage:n}=this.state,l=this.props.loading||null===a;if(t&&l)return(0,v.tZ)(m.Z,{"data-test-id":"events-request-loading"});if((0,c.Xe)(a,(0,h.ri)(s))){let t;const s={},d=Object.keys(a).map(((e,r)=>{const o=a[e],i=this.processData(o,r,(0,g.bQ)(e));return t||(t=i.timeframe),i.isMetricsData&&(s[e]={isMetricsData:i.isMetricsData}),[o.order||0,i.data[0],i.previousData,{isMetricsData:i.isMetricsData}]})).sort(((e,t)=>e[0]-t[0])),u=d.map((e=>e[1])),m=d.some((e=>null===e[2]))?void 0:d.map((e=>e[2]));return e({loading:l,reloading:o,errored:i,errorMessage:n,results:u,timeframe:t,previousTimeseriesData:m,seriesAdditionalInfo:s,...r})}if(a){var d,u;const{data:t,comparisonData:s,allData:m,originalData:c,totals:p,originalPreviousData:h,previousData:g,timeAggregatedData:v,timeframe:D,isMetricsData:f}=this.processData(a);return e({loading:l,reloading:o,errored:i,errorMessage:n,seriesAdditionalInfo:{[null!==(d=null===(u=this.props.currentSeriesNames)||void 0===u?void 0:u[0])&&void 0!==d?d:"current"]:{isMetricsData:f}},timeseriesData:t,comparisonTimeseriesData:s,allTimeseriesData:m,originalTimeseriesData:c,timeseriesTotals:p,originalPreviousTimeseriesData:h,previousTimeseriesData:g?[g]:g,timeAggregatedData:v,timeframe:D,...r})}return e({loading:l,reloading:o,errored:i,errorMessage:n,...r})}}b.displayName="EventsRequest",(0,s.Z)(b,"defaultProps",{period:void 0,start:null,end:null,interval:"1d",comparisonDelta:void 0,limit:15,query:"",includePrevious:!0,includeTransformedData:!0});const P=b},"./app/components/charts/loadingPanel.tsx":(e,t,r)=>{r.d(t,{Z:()=>n});var s=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),a=r("./app/components/loadingMask.tsx"),o=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const i=(0,s.Z)((e=>{let{height:t,...r}=e;return(0,o.tZ)("div",{...r,children:(0,o.tZ)(a.Z,{})})}),{target:"eumb2md0"})("flex:1;flex-shrink:0;overflow:hidden;height:",(e=>e.height),";position:relative;border-color:transparent;margin-bottom:0;");i.defaultProps={height:"200px"};const n=i},"./app/components/loadingMask.tsx":(e,t,r)=>{r.d(t,{Z:()=>s});const s=(0,r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js").Z)("div",{target:"e1dnwgq10"})("background-color:",(e=>e.theme.backgroundSecondary),";border-radius:",(e=>e.theme.borderRadius),";position:absolute;top:0;bottom:0;left:0;right:0;")},"./app/utils/getPeriod.tsx":(e,t,r)=>{r.d(t,{X:()=>n}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js"),r("../node_modules/core-js/modules/es.error.cause.js");var s=r("../node_modules/moment/moment.js"),a=r.n(s),o=r("./app/constants/index.tsx"),i=r("./app/utils/dates.tsx");function n(e){let{period:t,start:r,end:s}=e,{shouldDoublePeriod:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t||r||s||(t=o.GY),t){if(!n)return{statsPeriod:t};const[,e,r]=t.match(/([0-9]+)([mhdw])/);return{statsPeriod:`${2*parseInt(e,10)}${r}`}}if(!r||!s)throw new Error("start and end required");const l=(0,i.v5)(r),d=(0,i.v5)(s);if(n){const e=a()(s).diff(a()(r)),t=a()(r).subtract(e);return{start:(0,i.v5)(t),end:d}}return{start:l,end:d}}}}]);
//# sourceMappingURL=../sourcemaps/app_components_charts_eventsRequest_tsx.b8efa7d1a88124f006098b62a33609ee.js.map