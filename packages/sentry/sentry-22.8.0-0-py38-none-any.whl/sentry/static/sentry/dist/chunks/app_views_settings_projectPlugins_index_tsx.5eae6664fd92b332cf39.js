"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_projectPlugins_index_tsx"],{"./app/actionCreators/plugins.tsx":(t,e,s)=>{s.d(e,{Cg:()=>u,MM:()=>c,rR:()=>d}),s("../node_modules/core-js/modules/es.error.cause.js"),s("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=s("./app/actionCreators/indicator.tsx"),i=s("./app/actions/pluginActions.tsx"),r=s("./app/api.tsx"),o=s("./app/locale.tsx");const a={},l=new r.KU;function p(t){let{orgId:e,projectId:s,pluginId:n,update:r,...o}=t;i.Z.update(n,r);const a=l.requestPromise(`/projects/${e}/${s}/plugins/${n}/`,{...o});return a.then((()=>{i.Z.updateSuccess(n,r)})).catch((t=>{const e=t&&t.responseJSON&&"string"==typeof t.responseJSON.detail?new Error(t.responseJSON.detail):new Error("Unable to update plugin");i.Z.updateError(n,r,e)})),a}function c(t,e){let{orgId:s,projectId:n}=t;const r=`/projects/${s}/${n}/plugins/`;if(a[r])return a[r];i.Z.fetchAll(e);const o=l.requestPromise(r,{method:"GET",includeAllArgs:!0});return a[r]=o,o.then((t=>{let[e,s,n]=t;return i.Z.fetchAllSuccess(e,{pageLinks:null==n?void 0:n.getResponseHeader("Link")}),e})).catch((t=>{throw i.Z.fetchAllError(t),new Error("Unable to fetch plugins")})).then((()=>a[r]=null)),o}function u(t){return(0,n.E3)((0,o.t)("Enabling...")),p({...t,update:{enabled:!0},method:"POST"}).then((()=>(0,n.S9)((0,o.t)("Plugin was enabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to enable plugin"))))}function d(t){return(0,n.E3)((0,o.t)("Disabling...")),p({...t,update:{enabled:!1},method:"DELETE"}).then((()=>(0,n.S9)((0,o.t)("Plugin was disabled")))).catch((()=>(0,n.Iw)((0,o.t)("Unable to disable plugin"))))}},"./app/actions/pluginActions.tsx":(t,e,s)=>{s.d(e,{Z:()=>n});const n=(0,s("../node_modules/reflux/src/index.js").createActions)(["update","updateError","updateSuccess","fetchAll","fetchAllSuccess","fetchAllError"])},"./app/utils/recreateRoute.tsx":(t,e,s)=>{s.d(e,{Z:()=>o});var n=s("../node_modules/lodash/findLastIndex.js"),i=s.n(n),r=s("./app/utils/replaceRouterParams.tsx");function o(t,e){var s,n;const{routes:o,params:a,location:l,stepBack:p}=e,c=o.map((t=>{let{path:e}=t;return e||""}));let u,d;"string"!=typeof t?(d=o.indexOf(t)+1,u=i()(c.slice(0,d),(t=>"/"===t[0]))):u=i()(c,(t=>"/"===t[0]));let g=c.slice(u,d);void 0!==p&&(g=g.slice(0,p));const h=null!==(s=null==l?void 0:l.search)&&void 0!==s?s:"",m=null!==(n=null==l?void 0:l.hash)&&void 0!==n?n:"",x=`${g.join("")}${"string"!=typeof t?"":t}${h}${m}`;return(0,r.Z)(x,a)}},"./app/utils/withPlugins.tsx":(t,e,s)=>{s.d(e,{Z:()=>Z});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("./app/actionCreators/plugins.tsx"),o=s("../node_modules/reflux/src/index.js"),a=s("./app/actions/pluginActions.tsx"),l=s("./app/utils/makeSafeRefluxStore.ts");const p={loading:!0,plugins:[],error:null,pageLinks:null},c={plugins:null,state:{...p},updating:new Map,unsubscribeListeners:[],reset(){return this.plugins=null,this.state={...p},this.updating=new Map,this.state},getInitialState(){return this.getState()},getState(){const{plugins:t,...e}=this.state;return{...e,plugins:this.plugins?Array.from(this.plugins.values()):[]}},init(){this.reset(),this.unsubscribeListeners.push(this.listenTo(a.Z.fetchAll,this.onFetchAll)),this.unsubscribeListeners.push(this.listenTo(a.Z.fetchAllSuccess,this.onFetchAllSuccess)),this.unsubscribeListeners.push(this.listenTo(a.Z.fetchAllError,this.onFetchAllError)),this.unsubscribeListeners.push(this.listenTo(a.Z.update,this.onUpdate)),this.unsubscribeListeners.push(this.listenTo(a.Z.updateSuccess,this.onUpdateSuccess)),this.unsubscribeListeners.push(this.listenTo(a.Z.updateError,this.onUpdateError))},triggerState(){this.trigger(this.getState())},onFetchAll(){let{resetLoading:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t&&(this.state.loading=!0,this.state.error=null,this.plugins=null),this.triggerState()},onFetchAllSuccess(t,e){let{pageLinks:s}=e;this.plugins=new Map(t.map((t=>[t.id,t]))),this.state.pageLinks=s||null,this.state.loading=!1,this.triggerState()},onFetchAllError(t){this.plugins=null,this.state.loading=!1,this.state.error=t,this.triggerState()},onUpdate(t,e){if(!this.plugins)return;const s=this.plugins.get(t);if(!s)return;const n={...s,...e};this.plugins.set(t,n),this.updating.set(t,s),this.triggerState()},onUpdateSuccess(t,e){this.updating.delete(t)},onUpdateError(t,e,s){const n=this.updating.get(t);n&&this.plugins&&(this.plugins.set(t,n),this.updating.delete(t),this.state.error=s,this.triggerState())}},u=(0,o.createStore)((0,l.Y)(c));var d=s("./app/utils.tsx"),g=s("./app/utils/getDisplayName.tsx"),h=s("./app/utils/withOrganization.tsx"),m=s("./app/utils/withProject.tsx"),x=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const Z=function(t){class e extends i.Component{constructor(){super(...arguments),(0,n.Z)(this,"state",{plugins:[],loading:!0}),(0,n.Z)(this,"unsubscribe",u.listen((t=>{let{plugins:e,loading:s}=t;this.setState({plugins:e,loading:s})}),void 0))}componentDidMount(){this.fetchPlugins()}componentDidUpdate(t,e,s){const{organization:n,project:i}=this.props,r=t.organization||(null==s?void 0:s.organization),o=t.project||(null==s?void 0:s.project);if(!(0,d.ri)(o)||!(0,d.ri)(r))return;const a=r.slug===n.slug,l=o.slug===(null==i?void 0:i.slug);a&&l||this.fetchPlugins()}componentWillUnmount(){this.unsubscribe()}fetchPlugins(){const{organization:t,project:e}=this.props;e&&t&&(0,r.MM)({projectId:e.slug,orgId:t.slug})}render(){return(0,x.tZ)(t,{...this.props,plugins:this.state})}}return e.displayName="WithPlugins",(0,n.Z)(e,"displayName",`withPlugins(${(0,g.Z)(t)})`),(0,h.Z)((0,m.Z)(e))}},"./app/views/settings/project/permissionAlert.tsx":(t,e,s)=>{s.d(e,{Z:()=>l});var n=s("./app/components/acl/access.tsx"),i=s("./app/components/alert.tsx"),r=s("./app/locale.tsx"),o=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const a=t=>{let{access:e=["project:write"],...s}=t;return(0,o.tZ)(n.Z,{access:e,children:t=>{let{hasAccess:e}=t;return!e&&(0,o.tZ)(i.Z,{type:"warning",...s,children:(0,r.t)("These settings can only be edited by users with the organization owner, manager, or admin role.")})}})};a.displayName="PermissionAlert";const l=a},"./app/views/settings/projectPlugins/index.tsx":(t,e,s)=>{s.r(e),s.d(e,{default:()=>N});var n=s("../node_modules/@babel/runtime/helpers/esm/defineProperty.js"),i=(s("../node_modules/core-js/modules/web.dom-collections.iterator.js"),s("../node_modules/react/index.js")),r=s("./app/actionCreators/plugins.tsx"),o=s("./app/components/sentryDocumentTitle.tsx"),a=s("./app/locale.tsx"),l=s("./app/utils/integrationUtil.tsx"),p=s("./app/utils/withPlugins.tsx"),c=s("./app/views/settings/components/settingsPageHeader.tsx"),u=s("./app/views/settings/project/permissionAlert.tsx"),d=s("./app/components/acl/access.tsx"),g=s("./app/components/links/link.tsx"),h=s("./app/components/loadingIndicator.tsx"),m=s("./app/components/panels/index.tsx"),x=s("./app/views/routeError.tsx"),Z=s("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),b=s("./app/components/links/externalLink.tsx"),f=s("./app/components/switchButton.tsx"),j=s("./app/plugins/components/pluginIcon.tsx"),v=s("./app/utils/getDynamicText.tsx"),w=s("./app/utils/recreateRoute.tsx"),y=s("./app/utils/withOrganization.tsx"),S=s("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const A={name:"is2cq7",styles:"color:#979ba0"};class P extends i.PureComponent{constructor(){super(...arguments),(0,n.Z)(this,"handleChange",(()=>{const{onChange:t,id:e,enabled:s}=this.props;t(e,!s);const n=s?"integrations.disabled":"integrations.enabled";(0,l.Db)(n,{integration:e,integration_type:"plugin",view:"legacy_integrations",organization:this.props.organization})}))}render(){const{id:t,name:e,slug:s,version:n,author:i,hasConfiguration:r,enabled:o,canDisable:l}=this.props,p=(0,w.Z)(t,this.props);return(0,S.tZ)(d.Z,{access:["project:write"],children:c=>{let{hasAccess:u}=c;const d=u?g.Z:"span";return(0,S.BX)(_,{className:s,children:[(0,S.BX)(E,{children:[(0,S.tZ)(k,{size:48,pluginId:t}),(0,S.BX)(C,{children:[(0,S.BX)(L,{children:[`${e} `,(0,v.Z)({value:(0,S.tZ)(z,{children:n?`v${n}`:(0,S.tZ)("em",{children:(0,a.t)("n/a")})}),fixed:(0,S.tZ)(z,{children:"v10"})})]}),(0,S.BX)("div",{children:[i&&(0,S.tZ)(b.Z,{css:A,href:i.url,children:i.name}),r&&(0,S.BX)("span",{children:[" ","Â·"," ",(0,S.tZ)(d,{css:A,to:p,children:(0,a.t)("Configure plugin")})]})]})]})]}),(0,S.tZ)(f.Z,{size:"lg",isDisabled:!u||!l,isActive:o,toggle:this.handleChange})]},t)}})}}P.displayName="ProjectPluginRow";const I=(0,y.Z)(P),_=(0,Z.Z)("div",{target:"evund0f5"})({name:"zol16h",styles:"display:flex;flex:1;align-items:center"}),C=(0,Z.Z)("div",{target:"evund0f4"})({name:"1cepywk",styles:"display:flex;justify-content:center;flex-direction:column"}),E=(0,Z.Z)("div",{target:"evund0f3"})({name:"1l1txui",styles:"display:flex;flex:1;line-height:24px"}),L=(0,Z.Z)("div",{target:"evund0f2"})({name:"11g4mt0",styles:"font-size:16px"}),k=(0,Z.Z)(j.ZP,{target:"evund0f1"})({name:"o7nnmj",styles:"margin-right:16px"}),z=(0,Z.Z)("span",{target:"evund0f0"})({name:"qhuumn",styles:"color:#babec2"});class U extends i.Component{render(){const{plugins:t,loading:e,error:s,onChange:n,routes:i,params:r,project:o}=this.props,{orgId:l}=this.props.params,p=!s&&e;return s?(0,S.tZ)(x.Z,{error:s}):p?(0,S.tZ)(h.Z,{}):(0,S.BX)(m.s_,{children:[(0,S.BX)(m.V9,{children:[(0,S.tZ)("div",{children:(0,a.t)("Legacy Integration")}),(0,S.tZ)("div",{children:(0,a.t)("Enabled")})]}),(0,S.BX)(m.N,{children:[(0,S.tZ)(m.aU,{type:"warning",children:(0,S.tZ)(d.Z,{access:["org:integrations"],children:t=>{let{hasAccess:e}=t;return e?(0,a._N)("Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available. Visit the [link:organization integrations] settings to manage them.",{link:(0,S.tZ)(g.Z,{to:`/settings/${l}/integrations`})}):(0,a.t)("Legacy Integrations must be configured per-project. It's recommended to prefer organization integrations over the legacy project integrations when available.")}})}),t.filter((t=>!t.isHidden)).map((t=>(0,S.tZ)(m.Lv,{children:(0,S.tZ)(I,{params:r,routes:i,project:o,...t,onChange:n})},t.id)))]})]})}}U.displayName="ProjectPlugins";const D=U;class T extends i.Component{constructor(){super(...arguments),(0,n.Z)(this,"fetchData",(async()=>{const t=(await(0,r.MM)(this.props.params)).filter((t=>t.hasConfiguration&&t.enabled)).length;(0,l.Db)("integrations.index_viewed",{integrations_installed:t,view:"legacy_integrations",organization:this.props.organization},{startSession:!0})})),(0,n.Z)(this,"handleChange",((t,e)=>{const{projectId:s,orgId:n}=this.props.params;(e?r.Cg:r.rR)({projectId:s,orgId:n,pluginId:t})}))}componentDidMount(){this.fetchData()}render(){const{loading:t,error:e,plugins:s}=this.props.plugins||{},{orgId:n}=this.props.params,r=(0,a.t)("Legacy Integrations");return(0,S.BX)(i.Fragment,{children:[(0,S.tZ)(o.Z,{title:r,orgSlug:n}),(0,S.tZ)(c.Z,{title:r}),(0,S.tZ)(u.Z,{}),(0,S.tZ)(D,{...this.props,onChange:this.handleChange,loading:t,error:e,plugins:s})]})}}T.displayName="ProjectPluginsContainer";const N=(0,p.Z)(T)}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_projectPlugins_index_tsx.a4f2ef00e7ec9d3b9ae13d9cb13db869.js.map