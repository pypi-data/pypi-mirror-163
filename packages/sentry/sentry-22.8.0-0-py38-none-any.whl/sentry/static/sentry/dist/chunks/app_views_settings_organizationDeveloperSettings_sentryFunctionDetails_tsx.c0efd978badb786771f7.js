"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx"],{"./app/views/settings/organizationDeveloperSettings/sentryFunctionDetails.tsx":(e,n,t)=>{t.r(n),t.d(n,{default:()=>X}),t("../node_modules/core-js/modules/web.dom-collections.iterator.js"),t("../node_modules/core-js/modules/es.array.includes.js");var s=t("../node_modules/react/index.js"),o=t("../node_modules/react-router/es/index.js"),r=t("../node_modules/@monaco-editor/react/lib/es/index.js"),a=t("./app/actionCreators/indicator.tsx"),i=t("./app/components/acl/feature.tsx"),l=t("./app/components/asyncComponent.tsx"),c=t("./app/components/forms/form.tsx"),u=t("./app/components/forms/jsonForm.tsx"),d=t("./app/components/forms/model.tsx"),m=t("./app/components/panels/index.tsx"),p=t("./app/locale.tsx"),v=t("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),g=t("./app/components/button.tsx"),h=t("./app/components/forms/index.tsx"),b=t("./app/icons/index.tsx"),y=t("./app/styles/space.tsx"),f=t("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function Z(e){const{envVariables:n,setEnvVariables:t}=e;return(0,f.BX)("div",{children:[(0,f.BX)(m.V9,{children:[(0,p.t)("Environment Variables"),(0,f.tZ)(w,{size:"sm",type:"button",icon:(0,f.tZ)(b.N_,{isCircled:!0}),"aria-label":(0,p.t)("Add Environment Variable"),onClick:()=>{t([...n,{name:"",value:""}])}})]}),(0,f.BX)(_,{children:[(0,f.BX)(S,{children:[(0,f.tZ)(F,{children:(0,p.t)("Name")}),(0,f.tZ)(V,{children:(0,p.t)("Value")})]}),n.map(((e,s)=>(0,f.BX)(S,{children:[(0,f.tZ)(h.UP,{name:`env-variable-name-${s}`,type:"text",required:!1,inline:!1,defaultValue:e.name,value:e.name,stacked:!0,onChange:e=>((e,s)=>{const o=[...n];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],name:e},t(o)})(e,s)}),(0,f.tZ)(h.UP,{name:`env-variable-value-${s}`,type:"text",required:!1,inline:!1,defaultValue:e.value,value:e.value,stacked:!0,onChange:e=>((e,s)=>{const o=[...n];for(;o.length<=s;)o.push({name:"",value:""});o[s]={...o[s],value:e},t(o)})(e,s)}),(0,f.tZ)(E,{children:(0,f.tZ)(w,{size:"sm",icon:(0,f.tZ)(b.Fz,{}),type:"button","aria-label":(0,p._N)("Remove Environment Variable [i]",{i:s}),onClick:()=>(e=>{const s=[...n];s.splice(e,1),t(s)})(s)})})]},s)))]})]})}Z.displayName="SentryFunctionEnvironmentVariables";const x=Z,S=(0,v.Z)("div",{target:"etwnfrb5"})({name:"1dre63g",styles:"display:grid;grid-template-columns:1fr 1.5fr min-content"}),w=(0,v.Z)(g.ZP,{target:"etwnfrb4"})({name:"tjo4qw",styles:"float:right"}),F=(0,v.Z)("div",{target:"etwnfrb3"})("text-align:left;margin-top:",(0,y.Z)(2),";margin-bottom:",(0,y.Z)(1),";color:",(e=>e.theme.gray400),";"),V=(0,v.Z)(F,{target:"etwnfrb2"})("margin-left:-",(0,y.Z)(2),";"),E=(0,v.Z)("div",{target:"etwnfrb1"})("align-items:center;display:flex;margin-bottom:",(0,y.Z)(2),";"),_=(0,v.Z)(m.N,{target:"etwnfrb0"})("padding:",(0,y.Z)(2),";");var C=t("./app/views/settings/organizationDeveloperSettings/constants.tsx"),j=t("./app/views/settings/organizationDeveloperSettings/subscriptionBox.tsx");function B(e){const{events:n,setEvents:t}=e;function s(e,s){s&&!n.includes(e)?t(n.concat(e)):!s&&n.includes(e)&&t(n.filter((n=>n!==e)))}return(0,f.tZ)(k,{children:C.j2.map((n=>(0,f.tZ)(j.Z,{disabledFromPermissions:!1,webhookDisabled:!1,checked:e.events.includes(n),resource:n,onChange:s,isNew:"comment"===n},n)))})}B.displayName="SentryFunctionSubscriptions";const $=B,k=(0,v.Z)("div",{target:"e6znvl90"})("display:grid;grid-template:auto/1fr 1fr 1fr;@media (max-width: ",(e=>e.theme.breakpoints.large),"){grid-template:1fr 1fr 1fr/auto;}");class D extends d.Z{getTransformedData(){const e=super.getTransformedData(),n=[];e.onIssue&&n.push("issue"),e.onError&&n.push("error"),e.onComment&&n.push("comment"),delete e.onIssue,delete e.onError,delete e.onComment,e.events=n;const t=[];let s=0;for(;e[`env-variable-name-${s}`];)e[`env-variable-value-${s}`]&&t.push({name:e[`env-variable-name-${s}`],value:e[`env-variable-value-${s}`]}),delete e[`env-variable-name-${s}`],delete e[`env-variable-value-${s}`],s++;e.envVariables=t;const{...o}=e;return o}}const N=[{name:"name",type:"string",required:!0,placeholder:"e.g. My Sentry Function",label:"Name",help:"Human readable name of your Sentry Function"},{name:"author",type:"string",placeholder:"e.g. Acme Software",label:"Author",help:"The company or person who built and maintains this Sentry Function."},{name:"overview",type:"string",placeholder:"e.g. This Sentry Function does something useful",label:"Overview",help:"A short description of your Sentry Function."}];function q(e){const n=(0,s.useRef)(new D),{orgId:t,functionSlug:l}=e.params,{sentryFunction:d}=e,v=l?"PUT":"POST";let g=`/organizations/${t}/functions/`;l&&(g+=`${l}/`);const h=d?d.code:"exports.yourFunction = (req, res) => {\n    let message = req.query.message || req.body.message || 'Hello World!';\n    console.log('Query: ' + req.query);\n    console.log('Body: ' + req.body);\n    res.status(200).send(message);\n  };",[b,y]=(0,s.useState)((null==d?void 0:d.events)||[]);(0,s.useEffect)((()=>{n.current.setValue("onIssue",b.includes("issue")),n.current.setValue("onError",b.includes("error")),n.current.setValue("onComment",b.includes("comment"))}),[b]);const[Z,S]=(0,s.useState)((null==d?void 0:d.env_variables)||[{name:"",value:""}]);return(0,f.tZ)("div",{children:(0,f.BX)(i.Z,{features:["organizations:sentry-functions"],children:[(0,f.tZ)("h2",{children:d?(0,p.t)("Editing Sentry Function"):(0,p.t)("Create Sentry Function")}),(0,f.BX)(c.Z,{apiMethod:v,apiEndpoint:g,model:n.current,onPreSubmit:()=>{(0,a.E3)((0,p.t)("Saving changes.."))},initialData:{code:h,events:b,envVariables:Z,...e.sentryFunction},onSubmitError:e=>{let n=(0,p.t)("Unknown Error");var t;e.status>=400&&e.status<500&&(n=null!==(t=null==e?void 0:e.responseJSON.detail)&&void 0!==t?t:n),(0,a.Iw)(n)},onSubmitSuccess:e=>{(0,a.S9)((0,p.t)("Sentry Function successfully saved.",e.name));const n=`/settings/${t}/developer-settings/sentry-functions/${e.slug}/`;d?(0,a.S9)((0,p.t)("%s successfully saved.",e.name)):(0,a.S9)((0,p.t)("%s successfully created.",e.name)),o.browserHistory.push(n)},children:[(0,f.tZ)(u.Z,{forms:[{title:(0,p.t)("Sentry Function Details"),fields:N}]}),(0,f.BX)(m.s_,{children:[(0,f.tZ)(m.V9,{children:(0,p.t)("Webhooks")}),(0,f.tZ)(m.N,{children:(0,f.tZ)($,{events:b,setEvents:y})})]}),(0,f.tZ)(m.s_,{children:(0,f.tZ)(x,{envVariables:Z,setEnvVariables:S})}),(0,f.BX)(m.s_,{children:[(0,f.tZ)(m.V9,{children:(0,p.t)("Write your Code Below")}),(0,f.tZ)(m.N,{children:(0,f.tZ)(r.ZP,{height:"40vh",theme:"light",defaultLanguage:"javascript",defaultValue:h,onChange:function(e,t){n.current.setValue("code",e)},options:{minimap:{enabled:!1},scrollBeyondLastLine:!1}})})]})]})]})})}q.displayName="SentryFunctionDetails";class z extends l.Z{getEndpoints(){const{functionSlug:e,orgId:n}=this.props.params;return e?[["sentryFunction",`/organizations/${n}/functions/${e}/`]]:[]}renderBody(){return(0,f.tZ)(q,{sentryFunction:this.state.sentryFunction,...this.props})}}const X=z}}]);
//# sourceMappingURL=../sourcemaps/app_views_settings_organizationDeveloperSettings_sentryFunctionDetails_tsx.9195d6c904faa6d60647b9c3b0077daf.js.map