"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_events_eventReplay_replayContent_tsx-app_components_replays_utils_tsx-app_util-eb1887"],{"./app/components/events/eventReplay/replayContent.tsx":(e,t,r)=>{r.r(t),r.d(t,{default:()=>y});var n=r("../node_modules/@emotion/styled/base/dist/emotion-styled-base.browser.esm.js"),s=(r("../node_modules/core-js/modules/es.error.cause.js"),r("./app/components/dateTime.tsx")),a=r("./app/components/duration.tsx"),i=r("./app/components/placeholder.tsx"),o=r("./app/components/replays/replayContext.tsx"),l=r("./app/components/replays/replayView.tsx"),u=r("./app/locale.tsx"),c=r("./app/styles/space.tsx"),d=r("./app/utils/replays/hooks/useFullscreen.tsx"),p=r("./app/utils/replays/hooks/useReplayData.tsx"),m=r("./app/views/replays/detail/layout/fluidHeight.tsx"),g=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");function v(e){let{eventSlug:t,orgId:r}=e;const{fetching:n,replay:i,fetchError:c}=(0,p.Z)({eventSlug:t,orgId:r}),{ref:m,toggle:v}=(0,d.Z)(),y=null==i?void 0:i.getReplay(),b=null==i?void 0:i.getEvent();if(c)throw new Error("Failed to load Replay");return!n&&y&&b?(0,g.tZ)("table",{className:"table key-value",children:(0,g.BX)("tbody",{children:[(0,g.BX)("tr",{children:[(0,g.tZ)("td",{className:"key",children:(0,u.t)("Replay")}),(0,g.tZ)("td",{className:"value",children:(0,g.tZ)(o.z,{replay:i,initialTimeOffset:0,children:(0,g.tZ)(h,{ref:m,children:(0,g.tZ)(l.Z,{toggleFullscreen:v,showAddressBar:!1})})})})]},"replay"),(0,g.BX)("tr",{children:[(0,g.tZ)("td",{className:"key",children:(0,u.t)("Id")}),(0,g.tZ)("td",{className:"value",children:(0,g.tZ)("pre",{className:"val-string",children:y.replayId})})]},"id"),(0,g.BX)("tr",{children:[(0,g.tZ)("td",{className:"key",children:(0,u.t)("URL")}),(0,g.tZ)("td",{className:"value",children:(0,g.tZ)("pre",{className:"val-string",children:b.culprit})})]},"url"),(0,g.BX)("tr",{children:[(0,g.tZ)("td",{className:"key",children:(0,u.t)("Timestamp")}),(0,g.tZ)("td",{className:"value",children:(0,g.tZ)("pre",{className:"val-string",children:(0,g.tZ)(s.Z,{year:!0,seconds:!0,utc:!0,date:y.startedAt})})})]},"timestamp"),(0,g.BX)("tr",{children:[(0,g.tZ)("td",{className:"key",children:(0,u.t)("Duration")}),(0,g.tZ)("td",{className:"value",children:(0,g.tZ)("pre",{className:"val-string",children:(0,g.tZ)(a.Z,{seconds:y.duration/1e3,fixedDigits:0})})})]},"duration")]})}):(0,g.tZ)(f,{height:"400px",width:"100%"})}v.displayName="ReplayContent";const h=(0,n.Z)(m.Z,{target:"edkm01g1"})("margin-bottom:",(0,c.Z)(2),";background:",(e=>e.theme.background),";"),f=(0,n.Z)(i.Z,{target:"edkm01g0"})("margin-top:",(0,c.Z)(2),";"),y=v},"./app/components/replays/replayContext.tsx":(e,t,r)=>{r.d(t,{z:()=>p,M:()=>m}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/react/index.js"),s=r("../node_modules/@emotion/react/dist/emotion-element-cbed451f.browser.esm.js"),a=r("../node_modules/rrweb/es/rrweb/packages/rrweb/src/replay/index.js"),i=r("../node_modules/rrweb/es/rrweb/packages/rrweb/src/types.js");const o=new Map;function l(e){let{replayer:t,nodeId:r}=e;if(!o.has(r))return!1;const n=o.get(r);return!(!n||!t.wrapper.contains(n.canvas)||(t.wrapper.removeChild(n.canvas),o.delete(r),0))}var u=r("./app/utils/usePrevious.tsx"),c=r("../node_modules/@emotion/react/jsx-runtime/dist/emotion-react-jsx-runtime.browser.esm.js");const d=n.createContext({clearAllHighlights:()=>{},currentHoverTime:void 0,currentTime:0,dimensions:{height:0,width:0},fastForwardSpeed:0,highlight:()=>{},initRoot:()=>{},isBuffering:!1,isFinished:!1,isPlaying:!1,isSkippingInactive:!0,removeHighlight:()=>{},replay:null,restart:()=>{},setCurrentHoverTime:()=>{},setCurrentTime:()=>{},setSpeed:()=>{},speed:1,togglePlayPause:()=>{},toggleSkipInactive:()=>{}});function p(e){var t;let{children:r,replay:p,initialTimeOffset:m=0,value:g={}}=e;const v=null==p?void 0:p.getRRWebEvents(),h=(0,s.a)(),f=(0,u.Z)(v),y=v!==f,b=(0,n.useRef)(null),[w,k]=(0,n.useState)({height:0,width:0}),[T,x]=(0,n.useState)(),[C,Z]=(0,n.useState)(!1),[S,N]=(0,n.useState)(-1),[_,j]=(0,n.useState)(!0),[R,I]=(0,n.useState)(1),[M,A]=(0,n.useState)(0),[P,E]=(0,n.useState)({target:-1,previous:-1}),L=(0,n.useRef)(void 0),B=(0,n.useRef)(!1),D=(null===(t=b.current)||void 0===t?void 0:t.getCurrentTime())===S,F=e=>{k(e)},H=e=>{A(e.speed)},$=()=>{A(0)},X=(0,n.useCallback)((e=>{let{nodeId:t,annotation:r}=e;const n=b.current;n&&function(e){var t,r;let{replayer:n,nodeId:s,annotation:a="",color:i}=e;const{mouseTail:l,wrapper:u}=n,c=n.getMirror().getNode(s);if(!c||null===(t=n.iframe.contentDocument)||void 0===t||null===(r=t.body)||void 0===r||!r.contains(c))return null;const{top:d,left:p,width:m,height:g}=c.getBoundingClientRect(),v=null!=i?i:"rgba(168, 196, 236, 0.75)",h=l.cloneNode(),f=h.getContext("2d");if(!f)return null;f.fillStyle=v,f.fillRect(p,d,m,g),f.beginPath(),f.setLineDash([5,5]),f.moveTo(p,d),f.lineTo(p+m,d),f.lineTo(p+m,d+g),f.lineTo(p,d+g),f.closePath(),f.stroke(),f.font="24px Rubik",f.textAlign="right",f.textBaseline="bottom";const y=f.measureText(a).width;f.fillStyle="rgba(30, 30, 30, 0.75)",f.fillRect(p+m-y,d+g-30,y,30),f.fillStyle="white",f.fillText(a,p+m,d+g),o.set(s,{canvas:h}),u.insertBefore(h,l)}({replayer:n,nodeId:t,annotation:r})}),[]),z=(0,n.useCallback)((()=>{const e=b.current;e&&function(e){let{replayer:t}=e;for(const e of o.keys())l({replayer:t,nodeId:e})}({replayer:e})}),[]),q=(0,n.useCallback)((e=>{let{nodeId:t}=e;const r=b.current;r&&l({replayer:r,nodeId:t})}),[]),O=(0,n.useCallback)((()=>{var e,t;N(null!==(e=null===(t=b.current)||void 0===t?void 0:t.getCurrentTime())&&void 0!==e?e:-1),Z(!1)}),[]),Q=(0,n.useCallback)((e=>{if(void 0===v)return;if(null===e)return;if(b.current){var t;if(!y&&!B.current)return;if(0===(null===(t=b.current.iframe.contentDocument)||void 0===t?void 0:t.body.childElementCount))return;for(;e.firstChild;)e.removeChild(e.firstChild)}const r=new a.x(v,{root:e,blockClass:"sr-block",mouseTail:{duration:750,lineCap:"round",lineWidth:2,strokeStyle:h.purple200},skipInactive:!0});r.on(i.SA.Resize,F),r.on(i.SA.Finish,O),r.on(i.SA.SkipStart,H),r.on(i.SA.SkipEnd,$),b.current=r,B.current&&(B.current=!1)}),[v,h.purple200,O,y]);(0,n.useEffect)((()=>{const e=()=>{var e;"visible"!==document.visibilityState&&(null===(e=b.current)||void 0===e||e.pause())};return b.current&&v&&(Q(b.current.wrapper.parentElement),document.addEventListener("visibilitychange",e)),()=>{document.removeEventListener("visibilitychange",e)}}),[Q,v]);const W=(0,n.useCallback)((()=>b.current?Math.max(b.current.getCurrentTime(),0):0),[]),U=(0,n.useCallback)((e=>{var t;const r=b.current;if(!r)return;const n=e>(null===(t=b.current)||void 0===t?void 0:t.getMetaData().totalTime)?0:e;E({target:n,previous:W()}),L.current&&window.clearTimeout(L.current),C?(L.current=window.setTimeout((()=>r.play(n)),0),Z(!0)):(L.current=window.setTimeout((()=>r.pause(n)),0),Z(!1))}),[W,C]),V=(0,n.useCallback)((e=>{const t=b.current;t&&(C?(t.pause(),t.setConfig({speed:e}),t.play(W())):t.setConfig({speed:e}),I(e))}),[W,C]),G=(0,n.useCallback)((e=>{const t=b.current;t&&(e?t.play(W()):t.pause(W()),Z(e))}),[W]),J=(0,n.useCallback)((()=>{b.current&&(b.current.play(0),Z(!0))}),[]),K=(0,n.useCallback)((e=>{const t=b.current;t&&(e!==t.config.skipInactive&&t.setConfig({skipInactive:e}),j(e))}),[]);(0,n.useEffect)((()=>(m&&v&&b.current&&U(1e3*m),()=>{B.current=!0})),[v,b.current]);const Y=function(e){const[t,r]=(0,n.useState)(0);return function(e){(0,n.useEffect)((()=>{const t=window.requestAnimationFrame(e);return()=>window.cancelAnimationFrame(t)}),[e])}((()=>r(e))),t}(W),[ee,te]=-1!==P.target&&P.previous===Y&&P.target!==P.previous?[!0,P.target]:[!1,Y];return ee||-1===P.target||E({target:-1,previous:-1}),(0,c.tZ)(d.Provider,{value:{clearAllHighlights:z,currentHoverTime:T,currentTime:te,dimensions:w,fastForwardSpeed:M,highlight:X,initRoot:Q,isBuffering:ee,isFinished:D,isPlaying:C,isSkippingInactive:_,removeHighlight:q,replay:p,restart:J,setCurrentHoverTime:x,setCurrentTime:U,setSpeed:V,speed:R,togglePlayPause:G,toggleSkipInactive:K,...g},children:r})}p.displayName="Provider";const m=()=>(0,n.useContext)(d)},"./app/components/replays/utils.tsx":(e,t,r)=>{r.d(t,{DF:()=>c,DR:()=>d,NH:()=>o,PE:()=>m,Ul:()=>l,cs:()=>g,mr:()=>u}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/lodash/padStart.js"),s=r.n(n);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const r=String(e);return s()(r,t,"0")}const i=36e5;function o(e,t){return Math.abs(new Date(e).getTime()-t)}function l(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return u(o(e,t),r)}function u(e,t){if(e<=0||isNaN(e))return t?"00:00.000":"00:00";const r=Math.floor(e/i);e%=i;const n=Math.floor(e/6e4);e%=6e4;const s=Math.floor(e/1e3);let o="00:00";return o=r?`${a(r)}:${a(n)}:${a(s)}`:`${a(n)}:${a(s)}`,t&&(o=`${o}.${a(Math.floor(e%1e3),3)}`),o}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50,n=Math.floor(t/r);const s=e-n*t>0?1:0;n-=s;const a=[1*i,18e5,12e5,9e5,6e5,3e5,12e4,6e4,3e4,1e4,5e3,1e3],o=a.reduce(((t,r)=>(t.set(r,Math.floor(e/r)),t)),new Map),[l,u]=Array.from(o.entries()).filter((e=>{let[t,r]=e;return r<=n})).reduce(((e,t)=>t[1]>e[1]?t:e),[0,0]),c=(e-l*u)/l;return{timespan:l,cols:u,remaining:c}}function d(e,t,r,n){const s=isNaN(t)?1:t;return r.map((t=>{const{timestamp:r}=t,a=+new Date(String(r)),i=isNaN(a)?0:a-e,o=Math.floor(i/s*(n-1))+1;return[Math.max(1,o),t]})).reduce(((e,t)=>{let[r,n]=t;var s;return e.has(r)?null===(s=e.get(r))||void 0===s||s.push(n):e.set(r,[n]),e}),new Map)}function p(e,t){const r=e.startTimestamp<=t.startTimestamp&&t.startTimestamp<=e.endTimestamp,n=e.startTimestamp<=t.endTimestamp&&t.endTimestamp<=e.endTimestamp;return r||n}function m(e){if(!e.length)return[];const t=e.map((e=>{const t=1e3*e.startTimestamp,r=1e3*e.endTimestamp;return{spanCount:1,startTimestamp:t,endTimestamp:r,duration:r-t}})),[r,...n]=t,s=[r];for(const e of n){let t=!1;for(const r of s)if(p(r,e)){t=!0,r.spanCount+=1,r.startTimestamp=Math.min(r.startTimestamp,e.startTimestamp),r.endTimestamp=Math.max(r.endTimestamp,e.endTimestamp),r.duration=r.endTimestamp-r.startTimestamp;break}t||s.push(e)}return s}function g(e,t){return void 0===t||isNaN(t)||0===t?0:e/t}},"./app/utils/replays/hooks/useDiscoveryQuery.tsx":(e,t,r)=>{r.d(t,{Z:()=>u}),r("../node_modules/core-js/modules/web.dom-collections.iterator.js");var n=r("../node_modules/react/index.js"),s=r("./app/utils/discover/eventView.tsx"),a=r("./app/utils/useApi.tsx"),i=r("./app/utils/useOrganization.tsx");const o={isLoading:!0,error:void 0,data:void 0,pageLinks:void 0},l={query:{}};function u(e){let{endpoint:t,discoverQuery:r,ignoreCursor:u}=e;const[c,d]=(0,n.useState)(o),p=(0,a.Z)(),m=(0,i.Z)();return(0,n.useEffect)((()=>{!async function(){const e=t||`/organizations/${m.slug}/eventsv2/`,n=s.ZP.fromNewQueryWithLocation({environment:[],projects:[],id:"",name:"",version:2,...r},l).getEventsAPIPayload(l);d((e=>({...e,isLoading:!0,error:void 0}))),p.clear();try{const[t,,r]=await p.requestPromise(e,{includeAllArgs:!0,query:n});d((e=>{var n;return{...e,isLoading:!1,error:void 0,pageLinks:null!==(n=null==r?void 0:r.getResponseHeader("Link"))&&void 0!==n?n:e.pageLinks,data:t.data}}))}catch(e){d((t=>({...t,isLoading:!1,error:e,data:void 0})))}}()}),[t,r,m.slug,u]),c}}}]);
//# sourceMappingURL=../sourcemaps/app_components_events_eventReplay_replayContent_tsx-app_components_replays_utils_tsx-app_util-eb1887.53a7d4fb2d1196cd2e63ae53ee4da484.js.map